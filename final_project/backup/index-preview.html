<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.7.32">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="author" content="Mengjia Wei">
    <meta name="dcterms.date" content="2025-08-04">
    <meta name="keywords" content="PGM, Unemployment Rate, Unemployment Durations, Causal Inference">

    <title>Causal Inference of Labor Market Inequality Using PGM: A multidimensional analysis of unemployment rate and durations</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      html { -webkit-text-size-adjust: 100%; }
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      /* CSS for citations */
      div.csl-bib-body { }
      div.csl-entry {
        clear: both;
        margin-bottom: 0em;
      }
      .hanging-indent div.csl-entry {
        margin-left:2em;
        text-indent:-2em;
      }
      div.csl-left-margin {
        min-width:2em;
        float:left;
      }
      div.csl-right-inline {
        margin-left:2em;
        padding-left:1em;
      }
      div.csl-indent {
        margin-left: 2em;
      }    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8a894fcc3cb5e37eb5bf30def131be2f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      <meta name="citation_title" content="Causal Inference of Labor Market Inequality Using PGM: A multidimensional analysis of unemployment rate and durations">
<meta name="citation_abstract" content="In its revised report released on July 31, 2025, the U.S. Bureau of Labor Statistics (BLS) reported a sharp slowdown in job creation beginning in May, signaling heightened uncertainty and growing concerns about the overall health of the U.S. labor market. This study investigates the causal relationships between race, industry and unemployment rates in the United States, applying&nbsp;probabilistic graphical modeling (PGM)&nbsp;to uncover latent dependency structures across demographic and industry variables. Using a PGM framework, we extend this approach to labor market data by constructing conditional dependence networks across two key dimensions: group attributes (race and industry) and time (2024 vs. 2025). Specifically, the study examines recent college graduates (ages 22–24) relative to older individuals (25+), comparing their unemployment rates across 2024 and 2025. This study first examined the race effect on the unemployment rate disparitu. The industry-specific unemployment rate dynamics focuses on [retail] [] and [Leisure and hospitality] sectors. This analysis seeks to identify whether certain groups—such as Black labor force and [Retail Industry]—face higher or lower unemployment, providing a more comprehensive view of labor market hardship. The model estimates the strength and direction of probabilistic dependencies using Bayesian structure learning algorithms, based on labor force aggregated data from BLS CPS datasets. The results indicate that [conclusion1]. Additionally, the [retail], [], and [technology] industries experienced increased unemployment rates between the year of 2015 and the year of 2025, with respective changes of&nbsp;[ ],&nbsp;[ ], and&nbsp;[ ]&nbsp;percentage points. The PGM framework reveals significant interactive effects between race and industry on unemployment, particularly among Black workers&nbsp;and the&nbsp;[retail and hospitality]&nbsp;sectors. These findings contribute to the growing literature that leverages PGMs for social inference (e.g., Li et al., 2022), highlighting the model’s potential for uncovering structural labor inequalities over time and across population subgroups.
">
<meta name="citation_keywords" content="PGM,Unemployment Rate,Unemployment Durations,Causal Inference">
<meta name="citation_author" content="Mengjia Wei">
<meta name="citation_publication_date" content="2025-08-04">
<meta name="citation_cover_date" content="2025-08-04">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-08-04">
<meta name="citation_language" content="en">
<meta name="citation_journal_title" content="Georgetown Univeristy DSAN 5650 Journal">
<meta name="citation_reference" content="citation_title=Strategies for the development of volcanic hazard maps in monogenetic volcanic fields: The example of La Palma (Canary Islands);,citation_author=José Marrero;,citation_author=Alicia García;,citation_author=Manuel Berrocoso;,citation_author=Ángeles Llinares;,citation_author=Antonio Rodríguez-Losada;,citation_author=R. Ortiz;,citation_publication_date=2019-07;,citation_cover_date=2019-07;,citation_year=2019;,citation_doi=10.1186/s13617-019-0085-5;,citation_volume=8;,citation_journal_title=Journal of Applied Volcanology;">
<meta name="citation_reference" content="citation_title=Understanding black-white disparities in labor market outcomes requires models that account for persistent discrimination and unequal bargaining power;,citation_author=Valerie Wilson;,citation_author=William Darity-Jr.;,citation_publication_date=2022-03;,citation_cover_date=2022-03;,citation_year=2022;,citation_journal_title=Economic Policy Institute;">
<meta name="citation_reference" content="citation_title=Gender differences in unemployment trends: Race, jobs and the economy update for february 2024;,citation_author=Estee Smith Joseph Dean;,citation_publication_date=2024-03;,citation_cover_date=2024-03;,citation_year=2024;,citation_journal_title=NCRC;">
<meta name="citation_reference" content="citation_title=US UNEMPLOYMENT RATE BY INDUSTRY (2024);,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_journal_title=Oberlo;">
<meta name="citation_reference" content="citation_title=Degrees at risk: 10 US college majors with the highest unemployment rate in 2025;,citation_author=undefined TOIEducation;,citation_publication_date=2025-07;,citation_cover_date=2025-07;,citation_year=2025;,citation_journal_title=The Times Of India;">
<meta name="citation_reference" content="citation_title=Unemployment by industry: Duration must be considered, too;,citation_author=Paul Morris YiLi Chien;,citation_publication_date=2016-01;,citation_cover_date=2016-01;,citation_year=2016;,citation_journal_title=Federal Reserve Bank of St.Lois - Regional Economist;">
</head>

  <body class="quarto-notebook quarto-light">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Article Notebook</h6>

            <a href="./index.qmd" class="btn btn-primary quarto-download-embed" download="index.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causal Inference of Labor Market Inequality Using PGM: A multidimensional analysis of unemployment rate and durations</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Mengjia Wei <a href="mailto:mw1296@georgetown.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Georgetown University
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">August 4, 2025</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>In its revised report released on July 31, 2025, the U.S. Bureau of Labor Statistics (BLS) reported a sharp slowdown in job creation beginning in May, signaling heightened uncertainty and growing concerns about the overall health of the U.S. labor market. This study investigates the causal relationships between race, industry and unemployment rates in the United States, applying&nbsp;probabilistic graphical modeling (PGM)&nbsp;to uncover latent dependency structures across demographic and industry variables. Using a PGM framework, we extend this approach to labor market data by constructing conditional dependence networks across two key dimensions: group attributes (race and industry) and time (2024 vs.&nbsp;2025). Specifically, the study examines recent college graduates (ages 22–24) relative to older individuals (25+), comparing their unemployment rates across 2024 and 2025. This study first examined the race effect on the unemployment rate disparitu. The industry-specific unemployment rate dynamics focuses on [retail] [] and [Leisure and hospitality] sectors. This analysis seeks to identify whether certain groups—such as Black labor force and [Retail Industry]—face higher or lower unemployment, providing a more comprehensive view of labor market hardship. The model estimates the strength and direction of probabilistic dependencies using Bayesian structure learning algorithms, based on labor force aggregated data from BLS CPS datasets. The results indicate that [conclusion1]. Additionally, the [retail], [], and [technology] industries experienced increased unemployment rates between the year of 2015 and the year of 2025, with respective changes of&nbsp;[ ],&nbsp;[ ], and&nbsp;[ ]&nbsp;percentage points. The PGM framework reveals significant interactive effects between race and industry on unemployment, particularly among Black workers&nbsp;and the&nbsp;[retail and hospitality]&nbsp;sectors. These findings contribute to the growing literature that leverages PGMs for social inference (e.g., Li et al., 2022), highlighting the model’s potential for uncovering structural labor inequalities over time and across population subgroups.</p>
      </div>
    </div>

    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>PGM, Unemployment Rate, Unemployment Durations, Causal Inference</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">2</span> Data</a>
  <ul class="collapse">
  <li><a href="#define-the-prior-means-by-races" id="toc-define-the-prior-means-by-races" class="nav-link" data-scroll-target="#define-the-prior-means-by-races"><span class="header-section-number">4.3</span> Define the prior means by races</a></li>
  <li><a href="#define-the-unemployment-race-pymc" id="toc-define-the-unemployment-race-pymc" class="nav-link" data-scroll-target="#define-the-unemployment-race-pymc"><span class="header-section-number">4.4</span> Define the unemployment-race PyMC</a></li>
  <li><a href="#graph-the-unemployment-race-pgm" id="toc-graph-the-unemployment-race-pgm" class="nav-link" data-scroll-target="#graph-the-unemployment-race-pgm"><span class="header-section-number">4.5</span> Graph the unemployment-race PGM</a></li>
  <li><a href="#fit-the-unemployment-race-model---perform-mcmc-sampling" id="toc-fit-the-unemployment-race-model---perform-mcmc-sampling" class="nav-link" data-scroll-target="#fit-the-unemployment-race-model---perform-mcmc-sampling"><span class="header-section-number">4.6</span> Fit the unemployment-race Model - Perform MCMC Sampling</a></li>
  <li><a href="#analyze-unemployment-race-results-and-visualize" id="toc-analyze-unemployment-race-results-and-visualize" class="nav-link" data-scroll-target="#analyze-unemployment-race-results-and-visualize"><span class="header-section-number">4.7</span> Analyze unemployment-race Results and Visualize</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>The interplay of demographic characteristics and labor market dynamics consistently reveals significant disparities in unemployment rates. Decades of research reveal a persistent relationship between race, gender, and unemployment, evident across diverse economic cycles. Though the Black unemployment rate fell to a historic low of 6.1% in 2019, it was still twice as high as the White unemployment rate of 3.0%, as <span class="citation" data-cites="ValerieWilson2022">Wilson and Darity-Jr. (<a href="#ref-ValerieWilson2022" role="doc-biblioref">2022</a>)</span> observed. These disparities are further magnified at the intersection of race and gender. For instance, Black men faced a 6.1% unemployment rate in February 2024, notably higher than Black women at 4.4%. Similarly, Hispanic women’s unemployment rate increased to 5.0% in February 2024, while Hispanic men experienced a decrease to 4.0% (<span class="citation" data-cites="Joseph2024">Joseph Dean (<a href="#ref-Joseph2024" role="doc-biblioref">2024</a>)</span>). Native American men also experienced higher unemployment (10%) than Native American women (7%) in 2022. Industry-specific analyses similarly highlight divergent unemployment trends. The Leisure and Hospitality sector reported the highest unemployment rate at 6.0% in 2024, an increase from 5.5% in 2023. Similarly, Wholesale and Retail Trade experienced elevated unemployment, reaching 4.7% in October 2024, up from 4.0% in 2023. Conversely, Financial Activities maintained a significantly lower unemployment rate of 1.9% (<span class="citation" data-cites="Oberlo2024"><span>“US UNEMPLOYMENT RATE BY INDUSTRY (2024)”</span> (<a href="#ref-Oberlo2024" role="doc-biblioref">2024</a>)</span>).</p>
<p>Research from the U.S. Bureau of Labor Statistics consistently shows longer unemployment spells in sectors such as Manufacturing and Construction, while industries demanding specialized skills like Education and Health Services exhibit shorter durations. Study by <span class="citation" data-cites="YiLiChienandPaulMorris">YiLi Chien (<a href="#ref-YiLiChienandPaulMorris" role="doc-biblioref">2016</a>)</span> reveals negative correlation between the unemployment rate and duration. Such variations in both the rate and duration of unemployment underscore complex interactions among race, gender, age, and industry.</p>
<p><span class="citation" data-cites="TOIEducation2025">TOIEducation (<a href="#ref-TOIEducation2025" role="doc-biblioref">2025</a>)</span> published that the labor market for recent college graduates has “deteriorated noticeably” in the first quarter of 2025. The unemployment rate for this cohort (ages 22-27) ranged from 5.5% to 7.1%, exceeding the overall national average of 4.1-4.2%, with Anthropology (9.4%), Physics (7.8%), and Computer Engineering (7.5%) showing among the highest rates.</p>
<div id="fig-graduates" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graduates-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/unemployment_rate_recent_graduate.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Unemployment Rate of Recent College Graduates"><img src="images/unemployment_rate_recent_graduate.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graduates-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Unemployment Rate of Recent College Graduates
</figcaption>
</figure>
</div>
<p>Although the Federal Open Market Committee (FOMC) reported a low overall unemployment rate for June 2025 (Based on the U.S. Bureau of Labor Statistics (BLS) revised job creation data released on July 31, 2025, a marked decline in job creation has been observed beginning in May, raising substantial concerns regarding the stability of the U.S. labor market.), recent data clearly indicate a noticeable uptick in the unemployment rate for the 22-27 age group since March, reaching 2021 levels and particularly affecting recent college graduates (<a href="#fig-graduates" class="quarto-xref">Figure&nbsp;1</a>).</p>
</section>
<section id="data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="data"><span class="header-section-number">2</span> Data</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div id="96e259a1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell" data-tbl-center="true" data-tbl-col="true" data-execution_count="2">

<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data pre-processing - part1: Merge monthly unemployment rates by different demographics excel files downlaoded from BLS website</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#os.getcwd()</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_df_race(folder_path, demographic_type, id_vars, var_name, value_name):</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    file_name <span class="op">=</span> [f.removesuffix(<span class="st">'.xlsx'</span>) <span class="cf">for</span> f <span class="kw">in</span> os.listdir(os.path.join(<span class="st">"../data"</span>, folder_path)) <span class="cf">if</span> f.endswith(<span class="st">'.xlsx'</span>)]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> file_name:</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> os.path.join(<span class="st">"../data"</span>, folder_path, f <span class="op">+</span> <span class="st">".xlsx"</span>)    </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_excel(file_path)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        rows <span class="op">=</span> df[df.iloc[:,<span class="dv">0</span>]<span class="op">==</span><span class="st">'Year'</span>].index[<span class="dv">0</span>]<span class="op">+</span><span class="dv">2</span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_excel(file_path, skiprows<span class="op">=</span>rows)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        df_long <span class="op">=</span> df.melt(id_vars<span class="op">=</span>id_vars, var_name<span class="op">=</span>var_name, value_name<span class="op">=</span>value_name)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        df_long[demographic_type] <span class="op">=</span> f</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        merged_df <span class="op">=</span> pd.concat([merged_df, df_long], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> merged_df</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>folder_path_list <span class="op">=</span> [<span class="st">"unemployment_rate_by_race"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>             <span class="st">"unemployment_rate_by_sex"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>             <span class="st">"unemployment_rate_by_industry"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>             <span class="st">"unemployment_rate_by_age"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"unemployment_rate_by_education_attainment"</span>]</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>demographic_type_list <span class="op">=</span> [<span class="st">'Race'</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Sex'</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Industry'</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Age'</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Education_attainment'</span>]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>d_vars<span class="op">=</span><span class="st">"Year"</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>var_name<span class="op">=</span><span class="st">"Month"</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>value_name<span class="op">=</span><span class="st">"Unemployment_rate"</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>df_dic <span class="op">=</span> {}</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(folder_path_list)):</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    folder_path <span class="op">=</span> folder_path_list[i]</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    demographic_type<span class="op">=</span>demographic_type_list[i]</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    merged_df <span class="op">=</span> create_df_race(folder_path, demographic_type, <span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Unemployment_rate"</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    df_dic[demographic_type] <span class="op">=</span> merged_df</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>display(df_dic[<span class="st">'Race'</span>].head(<span class="dv">10</span>).style.hide(axis<span class="op">=</span><span class="st">'index'</span>).<span class="bu">format</span>({<span class="st">'Unemployment_rate'</span>:<span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>}))</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#list(df_dic.values())[0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-monthly-unemployment-rate-race" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-center="true" data-tbl-col="true" data-execution_count="2">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-monthly-unemployment-rate-race-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: BLS 2015-2025 Monthly Unemployment Rate By Race
</figcaption>
<div aria-describedby="tbl-monthly-unemployment-rate-race-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_b12f0" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_b12f0_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Year</th>
<th id="T_b12f0_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Month</th>
<th id="T_b12f0_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Unemployment_rate</th>
<th id="T_b12f0_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Race</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_b12f0_row0_col0" class="data row0 col0">2015</td>
<td id="T_b12f0_row0_col1" class="data row0 col1">Jan</td>
<td id="T_b12f0_row0_col2" class="data row0 col2">5.30</td>
<td id="T_b12f0_row0_col3" class="data row0 col3">white</td>
</tr>
<tr class="even">
<td id="T_b12f0_row1_col0" class="data row1 col0">2016</td>
<td id="T_b12f0_row1_col1" class="data row1 col1">Jan</td>
<td id="T_b12f0_row1_col2" class="data row1 col2">4.70</td>
<td id="T_b12f0_row1_col3" class="data row1 col3">white</td>
</tr>
<tr class="odd">
<td id="T_b12f0_row2_col0" class="data row2 col0">2017</td>
<td id="T_b12f0_row2_col1" class="data row2 col1">Jan</td>
<td id="T_b12f0_row2_col2" class="data row2 col2">4.70</td>
<td id="T_b12f0_row2_col3" class="data row2 col3">white</td>
</tr>
<tr class="even">
<td id="T_b12f0_row3_col0" class="data row3 col0">2018</td>
<td id="T_b12f0_row3_col1" class="data row3 col1">Jan</td>
<td id="T_b12f0_row3_col2" class="data row3 col2">3.90</td>
<td id="T_b12f0_row3_col3" class="data row3 col3">white</td>
</tr>
<tr class="odd">
<td id="T_b12f0_row4_col0" class="data row4 col0">2019</td>
<td id="T_b12f0_row4_col1" class="data row4 col1">Jan</td>
<td id="T_b12f0_row4_col2" class="data row4 col2">4.00</td>
<td id="T_b12f0_row4_col3" class="data row4 col3">white</td>
</tr>
<tr class="even">
<td id="T_b12f0_row5_col0" class="data row5 col0">2020</td>
<td id="T_b12f0_row5_col1" class="data row5 col1">Jan</td>
<td id="T_b12f0_row5_col2" class="data row5 col2">3.50</td>
<td id="T_b12f0_row5_col3" class="data row5 col3">white</td>
</tr>
<tr class="odd">
<td id="T_b12f0_row6_col0" class="data row6 col0">2021</td>
<td id="T_b12f0_row6_col1" class="data row6 col1">Jan</td>
<td id="T_b12f0_row6_col2" class="data row6 col2">6.20</td>
<td id="T_b12f0_row6_col3" class="data row6 col3">white</td>
</tr>
<tr class="even">
<td id="T_b12f0_row7_col0" class="data row7 col0">2022</td>
<td id="T_b12f0_row7_col1" class="data row7 col1">Jan</td>
<td id="T_b12f0_row7_col2" class="data row7 col2">3.90</td>
<td id="T_b12f0_row7_col3" class="data row7 col3">white</td>
</tr>
<tr class="odd">
<td id="T_b12f0_row8_col0" class="data row8 col0">2023</td>
<td id="T_b12f0_row8_col1" class="data row8 col1">Jan</td>
<td id="T_b12f0_row8_col2" class="data row8 col2">3.50</td>
<td id="T_b12f0_row8_col3" class="data row8 col3">white</td>
</tr>
<tr class="even">
<td id="T_b12f0_row9_col0" class="data row9 col0">2024</td>
<td id="T_b12f0_row9_col1" class="data row9 col1">Jan</td>
<td id="T_b12f0_row9_col2" class="data row9 col2">3.80</td>
<td id="T_b12f0_row9_col3" class="data row9 col3">white</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div></div></div>
</div></div>
<div id="7e164fa8" class="cell markdown">
<p>Data from the U.S. Bureau of Labor Statistics (BLS) 2015 to 2025 monthly aggregated unemployment rate by races. This dataset is used to analyze the race effect on unemployment along with the monthly unemployment rate aggregated data by race (<a href="#tbl-monthly-unemployment-rate-race" class="quarto-xref">Table&nbsp;1</a>).</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div id="4502433e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data pre-processing - part2: Load and process monthly unemployment overall file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df_overall <span class="op">=</span> pd.read_excel(<span class="st">"../data/unemployment_rate_monthly_data.xlsx"</span>, skiprows<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_overall_long <span class="op">=</span> df_overall.melt(id_vars<span class="op">=</span><span class="st">"Year"</span>, var_name<span class="op">=</span><span class="st">"Month"</span>, value_name<span class="op">=</span><span class="st">"Unemployment_rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell" data-tbl-center="true" data-tbl-col="true" data-execution_count="4">

<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data pre-processing - part3: Load and process Jun 2025 BLS labor survey data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># process the survey data</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df_survey_jun <span class="op">=</span> pd.read_csv(<span class="st">"../data/survey_data/jun_2025.csv"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>df_survey_jun.columns<span class="op">=</span> [<span class="st">"sex"</span>,<span class="st">"education_attainment"</span>,<span class="st">"race"</span>,<span class="st">"age"</span>,<span class="st">"employment_status"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"unmployment_duration"</span>,<span class="st">"industry"</span>,<span class="st">"occupation"</span>,<span class="st">"industry_detailed"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"occupation_detailed"</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">## create mapping tables to convert the demographic codes to the descriptions</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>sex_mapping <span class="op">=</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="st">"male"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="st">"female"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>education_attainment_codes <span class="op">=</span> <span class="bu">list</span>(np.arange(<span class="dv">31</span>,<span class="dv">47</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>education_attainment_values <span class="op">=</span> [</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="st">'less_than_high_school'</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="st">'high_school'</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="st">'some_college_or_associate_degree'</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="st">'some_college_or_associate_degree'</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="st">'some_college_or_associate_degree'</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="st">'bachelors_degree'</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="st">'masters_degree'</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="st">'professional_degree'</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="st">'doctoral_degree'</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    ]    </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>education_attainment_mapping<span class="op">=</span><span class="bu">dict</span>(<span class="bu">zip</span>(education_attainment_codes,education_attainment_values))</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>race_codes <span class="op">=</span> <span class="bu">list</span>(np.arange(<span class="dv">1</span>,<span class="dv">27</span>))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>race_values <span class="op">=</span> [</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"white"</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">"black"</span>,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">"other"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">"asian"</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    ] <span class="op">+</span> [<span class="st">"other"</span>] <span class="op">*</span> <span class="dv">22</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>race_mapping<span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(race_codes, race_values))</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>employment_status_codes <span class="op">=</span>[</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>employment_status_names <span class="op">=</span> [</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"employed"</span>,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">"employed"</span>,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">"unemployed"</span>,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"unemployed"</span>,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"not in labor force"</span>,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">"not in labor force"</span>,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">"not in labor force"</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>employment_status_mapping <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(employment_status_codes,employment_status_names))</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>industry_codes <span class="op">=</span> <span class="bu">list</span>(np.arange(<span class="dv">1</span>,<span class="dv">15</span>))</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>industry_names <span class="op">=</span> [</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Agriculture, forestry, fishing, and hunting"</span>,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mining"</span>,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Construction"</span>,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Manufacturing"</span>,</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Wholesale and retail trade"</span>,</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Transportation and utilities"</span>,</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Information"</span>,</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Financial activities"</span>,</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Professional and business services"</span>,</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Educational and health services"</span>,</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Leisure and hospitality"</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Other services"</span>,</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Public administration"</span>,</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Armed Forces"</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>industry_mapping <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(industry_codes, industry_names))</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="co">## Create new columns with decoded names</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'sex_name'</span>] <span class="op">=</span> df_survey_jun[<span class="st">'sex'</span>].<span class="bu">map</span>(sex_mapping)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'race_name'</span>] <span class="op">=</span> df_survey_jun[<span class="st">'race'</span>].<span class="bu">map</span>(race_mapping)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'education_attainment_name'</span>] <span class="op">=</span> df_survey_jun[<span class="st">'education_attainment'</span>].<span class="bu">map</span>(education_attainment_mapping)</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'employment_status_name'</span>] <span class="op">=</span> df_survey_jun[<span class="st">'employment_status'</span>].<span class="bu">map</span>(employment_status_mapping)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'industry_name'</span>] <span class="op">=</span> df_survey_jun[<span class="st">'industry'</span>].<span class="bu">map</span>(industry_mapping)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="co">## Filter out industry_name na rows</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>df_survey_jun <span class="op">=</span> df_survey_jun[<span class="op">~</span>df_survey_jun[<span class="st">'industry_name'</span>].isna()]</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="co">## Add columns "is_black" and "unemployment_status" for the binary model</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'is_black_african'</span>] <span class="op">=</span> (df_survey_jun[<span class="st">'race_name'</span>]<span class="op">==</span><span class="st">'black'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="co">## Add column is_asian for the binary model</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'is_asian'</span>] <span class="op">=</span> (df_survey_jun[<span class="st">'race_name'</span>]<span class="op">==</span><span class="st">'asian'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="co">## Add column is_asian for the binary model</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'is_white'</span>] <span class="op">=</span> (df_survey_jun[<span class="st">'race_name'</span>]<span class="op">==</span><span class="st">'white'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="co">## Add column employment_status for the binary model</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>df_survey_jun[<span class="st">'unemployment_status'</span>] <span class="op">=</span> (df_survey_jun[<span class="st">'employment_status_name'</span>]<span class="op">==</span><span class="st">'unemployed'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="co">## Display the table</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>display(df_survey_jun.loc[:,[col <span class="cf">for</span> col <span class="kw">in</span> df_survey_jun.columns <span class="cf">if</span> <span class="st">'name'</span> <span class="kw">in</span> col <span class="kw">or</span> col <span class="op">==</span> <span class="st">'is_black_african'</span>  <span class="kw">or</span> col <span class="op">==</span> <span class="st">'is_white'</span>  <span class="kw">or</span> col <span class="op">==</span> <span class="st">'is_asian'</span>]].head(<span class="dv">10</span>).style.hide(axis<span class="op">=</span><span class="st">'index'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-survey-data-jun2025" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-center="true" data-tbl-col="true" data-execution_count="4">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-survey-data-jun2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: BLS June 2025 Labor Force Survey Data
</figcaption>
<div aria-describedby="tbl-survey-data-jun2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_f6786" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_f6786_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">sex_name</th>
<th id="T_f6786_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">race_name</th>
<th id="T_f6786_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">education_attainment_name</th>
<th id="T_f6786_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">employment_status_name</th>
<th id="T_f6786_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">industry_name</th>
<th id="T_f6786_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">is_black_african</th>
<th id="T_f6786_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">is_asian</th>
<th id="T_f6786_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">is_white</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_f6786_row0_col0" class="data row0 col0">male</td>
<td id="T_f6786_row0_col1" class="data row0 col1">white</td>
<td id="T_f6786_row0_col2" class="data row0 col2">bachelors_degree</td>
<td id="T_f6786_row0_col3" class="data row0 col3">employed</td>
<td id="T_f6786_row0_col4" class="data row0 col4">Construction</td>
<td id="T_f6786_row0_col5" class="data row0 col5">0</td>
<td id="T_f6786_row0_col6" class="data row0 col6">0</td>
<td id="T_f6786_row0_col7" class="data row0 col7">1</td>
</tr>
<tr class="even">
<td id="T_f6786_row1_col0" class="data row1 col0">male</td>
<td id="T_f6786_row1_col1" class="data row1 col1">white</td>
<td id="T_f6786_row1_col2" class="data row1 col2">high_school</td>
<td id="T_f6786_row1_col3" class="data row1 col3">employed</td>
<td id="T_f6786_row1_col4" class="data row1 col4">Construction</td>
<td id="T_f6786_row1_col5" class="data row1 col5">0</td>
<td id="T_f6786_row1_col6" class="data row1 col6">0</td>
<td id="T_f6786_row1_col7" class="data row1 col7">1</td>
</tr>
<tr class="odd">
<td id="T_f6786_row2_col0" class="data row2 col0">female</td>
<td id="T_f6786_row2_col1" class="data row2 col1">white</td>
<td id="T_f6786_row2_col2" class="data row2 col2">bachelors_degree</td>
<td id="T_f6786_row2_col3" class="data row2 col3">employed</td>
<td id="T_f6786_row2_col4" class="data row2 col4">Manufacturing</td>
<td id="T_f6786_row2_col5" class="data row2 col5">0</td>
<td id="T_f6786_row2_col6" class="data row2 col6">0</td>
<td id="T_f6786_row2_col7" class="data row2 col7">1</td>
</tr>
<tr class="even">
<td id="T_f6786_row3_col0" class="data row3 col0">male</td>
<td id="T_f6786_row3_col1" class="data row3 col1">white</td>
<td id="T_f6786_row3_col2" class="data row3 col2">bachelors_degree</td>
<td id="T_f6786_row3_col3" class="data row3 col3">employed</td>
<td id="T_f6786_row3_col4" class="data row3 col4">Manufacturing</td>
<td id="T_f6786_row3_col5" class="data row3 col5">0</td>
<td id="T_f6786_row3_col6" class="data row3 col6">0</td>
<td id="T_f6786_row3_col7" class="data row3 col7">1</td>
</tr>
<tr class="odd">
<td id="T_f6786_row4_col0" class="data row4 col0">female</td>
<td id="T_f6786_row4_col1" class="data row4 col1">white</td>
<td id="T_f6786_row4_col2" class="data row4 col2">masters_degree</td>
<td id="T_f6786_row4_col3" class="data row4 col3">employed</td>
<td id="T_f6786_row4_col4" class="data row4 col4">Transportation and utilities</td>
<td id="T_f6786_row4_col5" class="data row4 col5">0</td>
<td id="T_f6786_row4_col6" class="data row4 col6">0</td>
<td id="T_f6786_row4_col7" class="data row4 col7">1</td>
</tr>
<tr class="even">
<td id="T_f6786_row5_col0" class="data row5 col0">female</td>
<td id="T_f6786_row5_col1" class="data row5 col1">white</td>
<td id="T_f6786_row5_col2" class="data row5 col2">bachelors_degree</td>
<td id="T_f6786_row5_col3" class="data row5 col3">employed</td>
<td id="T_f6786_row5_col4" class="data row5 col4">Construction</td>
<td id="T_f6786_row5_col5" class="data row5 col5">0</td>
<td id="T_f6786_row5_col6" class="data row5 col6">0</td>
<td id="T_f6786_row5_col7" class="data row5 col7">1</td>
</tr>
<tr class="odd">
<td id="T_f6786_row6_col0" class="data row6 col0">male</td>
<td id="T_f6786_row6_col1" class="data row6 col1">white</td>
<td id="T_f6786_row6_col2" class="data row6 col2">high_school</td>
<td id="T_f6786_row6_col3" class="data row6 col3">employed</td>
<td id="T_f6786_row6_col4" class="data row6 col4">Wholesale and retail trade</td>
<td id="T_f6786_row6_col5" class="data row6 col5">0</td>
<td id="T_f6786_row6_col6" class="data row6 col6">0</td>
<td id="T_f6786_row6_col7" class="data row6 col7">1</td>
</tr>
<tr class="even">
<td id="T_f6786_row7_col0" class="data row7 col0">female</td>
<td id="T_f6786_row7_col1" class="data row7 col1">white</td>
<td id="T_f6786_row7_col2" class="data row7 col2">bachelors_degree</td>
<td id="T_f6786_row7_col3" class="data row7 col3">employed</td>
<td id="T_f6786_row7_col4" class="data row7 col4">Professional and business services</td>
<td id="T_f6786_row7_col5" class="data row7 col5">0</td>
<td id="T_f6786_row7_col6" class="data row7 col6">0</td>
<td id="T_f6786_row7_col7" class="data row7 col7">1</td>
</tr>
<tr class="odd">
<td id="T_f6786_row8_col0" class="data row8 col0">male</td>
<td id="T_f6786_row8_col1" class="data row8 col1">white</td>
<td id="T_f6786_row8_col2" class="data row8 col2">less_than_high_school</td>
<td id="T_f6786_row8_col3" class="data row8 col3">employed</td>
<td id="T_f6786_row8_col4" class="data row8 col4">Professional and business services</td>
<td id="T_f6786_row8_col5" class="data row8 col5">0</td>
<td id="T_f6786_row8_col6" class="data row8 col6">0</td>
<td id="T_f6786_row8_col7" class="data row8 col7">1</td>
</tr>
<tr class="even">
<td id="T_f6786_row9_col0" class="data row9 col0">female</td>
<td id="T_f6786_row9_col1" class="data row9 col1">white</td>
<td id="T_f6786_row9_col2" class="data row9 col2">high_school</td>
<td id="T_f6786_row9_col3" class="data row9 col3">employed</td>
<td id="T_f6786_row9_col4" class="data row9 col4">Educational and health services</td>
<td id="T_f6786_row9_col5" class="data row9 col5">0</td>
<td id="T_f6786_row9_col6" class="data row9 col6">0</td>
<td id="T_f6786_row9_col7" class="data row9 col7">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div></div></div>
</div></div>
<div id="06aeb7c1" class="cell markdown">
<p>Data from the U.S. Bureau of Labor Statistics (BLS) June 2025 labor force survey provide individual-level employment status and corresponding demographic information. For the purpose of this study, a subset of these relevant columns is utilized (<a href="#tbl-survey-data-jun2025" class="quarto-xref">Table&nbsp;2</a>). This dataset is used to sample and predict employment status using the observations in the survey data.</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div class="cell" data-tbl-center="true" data-tbl-col="true" data-execution_count="5">

<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Data pre-processing part3: Process monthly survey data of 2024 Jan-Jul and 2025 Jan-Jul</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>survey_file_names <span class="op">=</span> [f.removesuffix(<span class="st">".csv"</span>) <span class="cf">for</span> f <span class="kw">in</span> os.listdir(<span class="st">'../data/survey_data'</span>) <span class="cf">if</span> f.endswith(<span class="st">"csv"</span>)]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'prmjind1'</span>, <span class="st">'pemlr'</span>] <span class="co"># keep columns industry and employment_status</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>survey_df <span class="op">=</span> []</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> survey_file_names:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    survey_file <span class="op">=</span> pd.read_csv(os.path.join(<span class="st">'../data/survey_data/'</span>, s <span class="op">+</span> <span class="st">".csv"</span> ))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    survey_data <span class="op">=</span> survey_file[cols]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    survey_data.columns<span class="op">=</span>[<span class="st">'industry'</span>,<span class="st">'employment_status'</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    survey_data[<span class="st">'month_year'</span>] <span class="op">=</span> s</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    survey_df.append(survey_data)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all into a single DataFrame</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>survey_df <span class="op">=</span> pd.concat(survey_df, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># decode the industry and employment_status columns</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>survey_df[<span class="st">'industry_name'</span>] <span class="op">=</span> survey_df[<span class="st">'industry'</span>].<span class="bu">map</span>(industry_mapping)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>survey_df <span class="op">=</span> survey_df[<span class="op">~</span>survey_df[<span class="st">'industry_name'</span>].isna()]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>survey_df[<span class="st">'employment_status_description'</span>] <span class="op">=</span> survey_df[<span class="st">'employment_status'</span>].<span class="bu">map</span>(employment_status_mapping)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>display(survey_df.head(<span class="dv">10</span>).style.hide(axis<span class="op">=</span><span class="st">'index'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-survey-data-2024-2025" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-center="true" data-tbl-col="true" data-execution_count="5">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-survey-data-2024-2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: BLS 2024 - 2025 Jan - Jul Labor Force Survey Data
</figcaption>
<div aria-describedby="tbl-survey-data-2024-2025-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_c00f4" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_c00f4_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">industry</th>
<th id="T_c00f4_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">employment_status</th>
<th id="T_c00f4_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">month_year</th>
<th id="T_c00f4_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">industry_name</th>
<th id="T_c00f4_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">employment_status_description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_c00f4_row0_col0" class="data row0 col0">11</td>
<td id="T_c00f4_row0_col1" class="data row0 col1">1</td>
<td id="T_c00f4_row0_col2" class="data row0 col2">jan_2024</td>
<td id="T_c00f4_row0_col3" class="data row0 col3">Leisure and hospitality</td>
<td id="T_c00f4_row0_col4" class="data row0 col4">employed</td>
</tr>
<tr class="even">
<td id="T_c00f4_row1_col0" class="data row1 col0">11</td>
<td id="T_c00f4_row1_col1" class="data row1 col1">1</td>
<td id="T_c00f4_row1_col2" class="data row1 col2">jan_2024</td>
<td id="T_c00f4_row1_col3" class="data row1 col3">Leisure and hospitality</td>
<td id="T_c00f4_row1_col4" class="data row1 col4">employed</td>
</tr>
<tr class="odd">
<td id="T_c00f4_row2_col0" class="data row2 col0">10</td>
<td id="T_c00f4_row2_col1" class="data row2 col1">1</td>
<td id="T_c00f4_row2_col2" class="data row2 col2">jan_2024</td>
<td id="T_c00f4_row2_col3" class="data row2 col3">Educational and health services</td>
<td id="T_c00f4_row2_col4" class="data row2 col4">employed</td>
</tr>
<tr class="even">
<td id="T_c00f4_row3_col0" class="data row3 col0">5</td>
<td id="T_c00f4_row3_col1" class="data row3 col1">1</td>
<td id="T_c00f4_row3_col2" class="data row3 col2">jan_2024</td>
<td id="T_c00f4_row3_col3" class="data row3 col3">Wholesale and retail trade</td>
<td id="T_c00f4_row3_col4" class="data row3 col4">employed</td>
</tr>
<tr class="odd">
<td id="T_c00f4_row4_col0" class="data row4 col0">4</td>
<td id="T_c00f4_row4_col1" class="data row4 col1">4</td>
<td id="T_c00f4_row4_col2" class="data row4 col2">jan_2024</td>
<td id="T_c00f4_row4_col3" class="data row4 col3">Manufacturing</td>
<td id="T_c00f4_row4_col4" class="data row4 col4">unemployed</td>
</tr>
<tr class="even">
<td id="T_c00f4_row5_col0" class="data row5 col0">8</td>
<td id="T_c00f4_row5_col1" class="data row5 col1">1</td>
<td id="T_c00f4_row5_col2" class="data row5 col2">jan_2024</td>
<td id="T_c00f4_row5_col3" class="data row5 col3">Financial activities</td>
<td id="T_c00f4_row5_col4" class="data row5 col4">employed</td>
</tr>
<tr class="odd">
<td id="T_c00f4_row6_col0" class="data row6 col0">9</td>
<td id="T_c00f4_row6_col1" class="data row6 col1">1</td>
<td id="T_c00f4_row6_col2" class="data row6 col2">jan_2024</td>
<td id="T_c00f4_row6_col3" class="data row6 col3">Professional and business services</td>
<td id="T_c00f4_row6_col4" class="data row6 col4">employed</td>
</tr>
<tr class="even">
<td id="T_c00f4_row7_col0" class="data row7 col0">5</td>
<td id="T_c00f4_row7_col1" class="data row7 col1">1</td>
<td id="T_c00f4_row7_col2" class="data row7 col2">jan_2024</td>
<td id="T_c00f4_row7_col3" class="data row7 col3">Wholesale and retail trade</td>
<td id="T_c00f4_row7_col4" class="data row7 col4">employed</td>
</tr>
<tr class="odd">
<td id="T_c00f4_row8_col0" class="data row8 col0">4</td>
<td id="T_c00f4_row8_col1" class="data row8 col1">1</td>
<td id="T_c00f4_row8_col2" class="data row8 col2">jan_2024</td>
<td id="T_c00f4_row8_col3" class="data row8 col3">Manufacturing</td>
<td id="T_c00f4_row8_col4" class="data row8 col4">employed</td>
</tr>
<tr class="even">
<td id="T_c00f4_row9_col0" class="data row9 col0">4</td>
<td id="T_c00f4_row9_col1" class="data row9 col1">1</td>
<td id="T_c00f4_row9_col2" class="data row9 col2">jan_2024</td>
<td id="T_c00f4_row9_col3" class="data row9 col3">Manufacturing</td>
<td id="T_c00f4_row9_col4" class="data row9 col4">employed</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div></div></div>
</div></div>
<div id="8ba28b65" class="cell markdown">
<p>Data from the U.S. Bureau of Labor Statistics (BLS) historical monthly labor force survey provide individual-level employment status by industries. For the purpose of this study, we utilized 2024 Jan to Jul and 2025 Jan to Jun data. (<a href="#tbl-survey-data-2024-2025" class="quarto-xref">Table&nbsp;3</a>). This dataset is used to analyze the industry effect on unemployment rate in the recent 2 years.</p>
<section id="eda" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="eda"><span class="header-section-number">3</span> EDA</h2>
<section id="unemployment-rates-of-differenet-races" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="unemployment-rates-of-differenet-races"><span class="header-section-number">3.1</span> Unemployment Rates of Differenet Races</h3>
</section>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div id="924ab26d" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distributions of unemployment stats of different demographic categories </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">## 1. Plot the umemployment rate distributions by gender, age, industry, education_unattainment</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_hist(df_plot, demographic_type):</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    unique_categories <span class="op">=</span> df_plot[demographic_type].unique()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    num_unique_categories <span class="op">=</span> <span class="bu">len</span>(unique_categories)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    ncol <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    nrow <span class="op">=</span> np.int64(np.ceil(num_unique_categories<span class="op">/</span>ncol))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(ncols<span class="op">=</span>ncol, nrows<span class="op">=</span>nrow, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>, figsize <span class="op">=</span> (<span class="dv">16</span>,nrow<span class="op">*</span><span class="dv">5</span>))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    axes <span class="op">=</span> axes.flatten()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    min_rate <span class="op">=</span> df_plot[<span class="st">'Unemployment_rate'</span>].<span class="bu">min</span>()</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    max_rate <span class="op">=</span> df_plot[<span class="st">'Unemployment_rate'</span>].<span class="bu">max</span>()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    num_bins <span class="op">=</span> <span class="dv">20</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> np.linspace(min_rate, max_rate, num_bins <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, category <span class="kw">in</span> <span class="bu">enumerate</span>(unique_categories):</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> axes[i]</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        vals <span class="op">=</span> df_plot[df_plot[demographic_type]<span class="op">==</span>category][<span class="st">'Unemployment_rate'</span>]</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        ax.hist(vals, bins<span class="op">=</span>bins, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        ax.axvline(np.mean(vals), color <span class="op">=</span> <span class="st">'black'</span>, linestyle <span class="op">=</span> <span class="st">"--"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        ax.set_title(category, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'Unemployment Rate'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Count'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="ss">f'Unemployment Rate Distribution by </span><span class="sc">{</span>demographic_type<span class="sc">}</span><span class="ss">'</span>, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">18</span>) </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the graphs except for the last one in order to add the ariticle label to the last grapph</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(df_dic.keys())<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> <span class="bu">list</span>(df_dic.values())[i]</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    demographic_type <span class="op">=</span> <span class="bu">list</span>(df_dic.keys())[i]</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Unemployment Rate Distribution Histograms By </span><span class="sc">{</span>demographic_type<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    plot_hist(df_plot, demographic_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unemployment Rate Distribution Histograms By Race</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-7-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/cell-7-output-2.png" width="1526" height="494" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Unemployment Rate Distribution Histograms By Sex</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-7-output-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/cell-7-output-4.png" width="1525" height="494" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Unemployment Rate Distribution Histograms By Industry</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-7-output-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/cell-7-output-6.png" width="1526" height="2453" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Unemployment Rate Distribution Histograms By Age</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-7-output-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/cell-7-output-8.png" width="1526" height="984" class="figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div id="cell-fig-histogram-unemployment-rate-demographics" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 2. Plot the overall umemployment rate </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Display this graph separately from the preious chuck in order to add the aritcle label</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_plot <span class="op">=</span> <span class="bu">list</span>(df_dic.values())[<span class="bu">len</span>(df_dic.keys())<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>demographic_type <span class="op">=</span> <span class="bu">list</span>(df_dic.keys())[<span class="bu">len</span>(df_dic.keys())<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unemployment Rate Distribution Histograms By </span><span class="sc">{</span>demographic_type<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plot_hist(df_plot, demographic_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unemployment Rate Distribution Histograms By Education_attainment</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-histogram-unemployment-rate-demographics" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Histogram plots of the unemployment rate distributins by Age, Sex, Race, Industry and Education Attainment using 2015-2025 BLS data">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-unemployment-rate-demographics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="index_files/figure-html/fig-histogram-unemployment-rate-demographics-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;2: Unemployment Rate Distributions By Demographics (2015-2025 statistics)"><img src="index_files/figure-html/fig-histogram-unemployment-rate-demographics-output-2.png" alt="Histogram plots of the unemployment rate distributins by Age, Sex, Race, Industry and Education Attainment using 2015-2025 BLS data" width="1526" height="984" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-unemployment-rate-demographics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Unemployment Rate Distributions By Demographics (2015-2025 statistics)
</figcaption>
</figure>
</div>
</div>
</div></div>
<div id="81075c73" class="cell markdown">
<p>BLS data from 2015–2025 indicate that the Black or African American population experienced the highest average unemployment rate (7.5%), primarily within the 5–10% range. Gender differences are minimal, with both averaging around 5%, though rates are slightly higher for men. Among industries, Leisure and Hospitality recorded the highest unemployment (10%) with a long-tail distribution, followed by Agriculture (5–11%) and moderate variability. Construction and Mining/Oil &amp; Gas exhibit similar but marginally lower patterns. The 22–24 age group stands out with significantly elevated unemployment—averaging 7% and predominantly above 5%—while other age groups display lower and more uniform rates. Financial Activities show the lowest and most stable unemployment, consistently under 5%. Individuals without a high school diploma face high and variable unemployment, averaging 7% with a long-tail skew. These patterns suggest that young adults (22–24), Black or African Americans without college degrees, and those employed in Leisure, Construction, or Mining sectors are disproportionately affected by higher unemployment. (<a href="#fig-histogram-unemployment-rate-demographics" class="quarto-xref">Figure&nbsp;2</a>).</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div id="cell-fig-histogram-unemployment-rate" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>min_rate <span class="op">=</span> df_overall_long[<span class="st">'Unemployment_rate'</span>].<span class="bu">min</span>()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>max_rate <span class="op">=</span> df_overall_long[<span class="st">'Unemployment_rate'</span>].<span class="bu">max</span>()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>num_bins <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> np.linspace(min_rate, max_rate, num_bins)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">7</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>ax.hist(df_overall_long[<span class="st">'Unemployment_rate'</span>], bins<span class="op">=</span>bins, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>ax.axvline(np.mean(df_overall_long[<span class="st">'Unemployment_rate'</span>]), color<span class="op">=</span><span class="st">"black"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Unemployment Rate"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Count"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Population Unemployment Rate"</span>, y <span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-histogram-unemployment-rate" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Histogram plot of the overall population unemployment rate distributions using 2015-2025 BLS data">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-unemployment-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="index_files/figure-html/fig-histogram-unemployment-rate-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;3: Overall Population Unemployment Rate Distributions (2015-2025 statistics)"><img src="index_files/figure-html/fig-histogram-unemployment-rate-output-1.png" alt="Histogram plot of the overall population unemployment rate distributions using 2015-2025 BLS data" width="758" height="690" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-unemployment-rate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Overall Population Unemployment Rate Distributions (2015-2025 statistics)
</figcaption>
</figure>
</div>
</div>
</div></div>
<div id="41a02e19" class="cell markdown">
<p>According to BLS data from 2015–2025, the overall population unemployment rate averaged slightly above 4%, with the majority of observations concentrated between 2% and 5% and exhibiting relatively low variability (<a href="#fig-histogram-unemployment-rate" class="quarto-xref">Figure&nbsp;3</a>).</p>
<section id="unemployment-rates-of-differenet-industries" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="unemployment-rates-of-differenet-industries"><span class="header-section-number">3.2</span> Unemployment Rates of Differenet Industries</h3>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="cell-fig-boxplot-unemployment-rate-industry" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot for unemployment rate by industry</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>df_industry <span class="op">=</span> df_dic[<span class="st">'Industry'</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df_industry <span class="op">=</span> df_industry[<span class="op">~</span>df_industry[<span class="st">'Year'</span>].isin([<span class="dv">2020</span>,<span class="dv">2021</span>])]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">14</span>,<span class="dv">10</span>))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>sns.boxplot(df_industry, x<span class="op">=</span><span class="st">"Industry"</span>, y<span class="op">=</span><span class="st">"Unemployment_rate"</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Industry'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Unemployment Rate'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Distribution of Unemployment Rate by Industry'</span>, y <span class="op">=</span> <span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">13</span>, rotation<span class="op">=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-boxplot-unemployment-rate-industry" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Boxplot of the industry unemployment rates distributions using 2015-2025 BLS data">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot-unemployment-rate-industry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="index_files/figure-html/fig-boxplot-unemployment-rate-industry-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;4: Unemployment Rate Distributions By Industries (2015-2025 statistics)"><img src="index_files/figure-html/fig-boxplot-unemployment-rate-industry-output-1.png" alt="Boxplot of the industry unemployment rates distributions using 2015-2025 BLS data" width="1108" height="1232" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-unemployment-rate-industry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Unemployment Rate Distributions By Industries (2015-2025 statistics)
</figcaption>
</figure>
</div>
</div>
</div></div>
<div id="1171a8ca" class="cell markdown">
<p>The boxplot illustrates notable variation in unemployment rates across industries. “Agricultural, mining/oil/gas extraction” and “Construction” industries exhibit the highest variation and upper extremes, indicating greater instability in employment. Due to the volatility and unpredictivity as a result of seasonlity, these two categories are going to be excluded from our analysis. In contrast, “Government”, “Financial services”, and “Education/health services” show consistently low and stable unemployment rates, with narrower interquartile ranges and fewer outliers. These patterns suggest structural differences in labor market vulnerability across sectors. (<a href="#fig-boxplot-unemployment-rate-industry" class="quarto-xref">Figure&nbsp;4</a>).</p>
<section id="pgm" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="pgm"><span class="header-section-number">4</span> PGM</h2>
<p>We posit that unemployment vulnerability is driven by structural inequalities within the labor market, particularly those rooted in demographic and industrial dimensions. Demographic disparities are represented by variables such as race, age, and educational attainment and industry; sex is excluded from the analysis due to prior findings indicating minimal impact on unemployment rates. Establishing a baseline unemployment level is a necessary step before assessing the marginal effects of these demographic and industrial factors.</p>
<section id="baseline-unemployment-rate-distribution" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="baseline-unemployment-rate-distribution"><span class="header-section-number">4.1</span> Baseline unemployment rate distribution</h3>
<p>Figure 3 illustrates that the population unemployment rate is right-skewed, suggesting that the Log-Normal distribution is an appropriate model. We are going to estimate the parameters of a Log-Normal distribution from the population distribution data using MLE. (<span class="math inline">\(\sigma\)</span>, <span class="math inline">\(\text{loc}\)</span>, and <span class="math inline">\(\text{scale}\)</span>).</p>
</section>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div id="cell-fig-histogram-lognorm" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit log-norm distribution using population unemployment rate data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> lognorm, kstest, skew </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Get the unemployment_rate data that is not NA, convert to array</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>data_to_fit <span class="op">=</span> df_overall_long[<span class="op">~</span>np.isnan(np.array(df_overall_long[<span class="st">'Unemployment_rate'</span>]))][<span class="st">'Unemployment_rate'</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>sigma_fit, loc_fit, scale_fit <span class="op">=</span> lognorm.fit(data_to_fit) <span class="co"># Fit log-normal distribution</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the estimated parameters</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Fitted Log-Norm Distribution Parameters:"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Shape parameter 'alpha'): </span><span class="sc">{</span>sigma_fit<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Location parameter (loc): </span><span class="sc">{</span>loc_fit<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Scale parameter (scale): </span><span class="sc">{</span>scale_fit<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the fit</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">9</span>))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">## Histogram of the unemployment data</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>ax.hist(data_to_fit, bins<span class="op">=</span><span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Data Histogram'</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">## Fitted log-norm pdf</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> ax.get_xlim()</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> lognorm.pdf(x, sigma_fit, loc<span class="op">=</span>loc_fit, scale<span class="op">=</span>scale_fit)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>ax.plot(x, p, <span class="st">'darkred'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Fitted Log-Normal PDF'</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Unemployment Rate'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Data Histogram vs. Fitted Log-Normal Distribution PDF"</span>, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Fitted Log-Norm Distribution Parameters:
  Shape parameter 'alpha'): 9.92
  Location parameter (loc): 3.20
  Scale parameter (scale): 0.03</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-histogram-lognorm" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Plot the histogram of unemployment rate data and overlay the Probability Density Function (PDF) of the fitted log-norm distribution.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-lognorm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="index_files/figure-html/fig-histogram-lognorm-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;5: Unmployment Rate Histogram vs.&nbsp;Fitted Log-Norm PDF"><img src="index_files/figure-html/fig-histogram-lognorm-output-2.png" alt="Plot the histogram of unemployment rate data and overlay the Probability Density Function (PDF) of the fitted log-norm distribution." width="950" height="886" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-lognorm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Unmployment Rate Histogram vs.&nbsp;Fitted Log-Norm PDF
</figcaption>
</figure>
</div>
</div>
</div></div>
<div id="f7406dd3" class="cell markdown">
<p>By overlaying the smooth PDF curve on top of original data’s histogram, we can visualize that the Log-Normal distribution matches the distribution of the actual data. The peak of the PDF align with the peak of the histogram. The spread of the PDF roughly match the spread of the data, including the tail (<a href="#fig-histogram-lognorm" class="quarto-xref">Figure&nbsp;5</a>). Now we need to use Kolmogorov-Smirnov Test to test Goodness-of-fit with the original data and estimated parameters, then examine the p value.</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div id="d4798037" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KS goodness of fit test</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>d_statistic, p_value <span class="op">=</span> kstest(data_to_fit, <span class="kw">lambda</span> x: lognorm.cdf(x, sigma_fit, loc<span class="op">=</span>loc_fit, scale<span class="op">=</span>scale_fit)) </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Kolmogorov-Smirnov Test Results:"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  D-statistic: </span><span class="sc">{</span>d_statistic<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Kolmogorov-Smirnov Test Results:
  D-statistic: 0.4592
  P-value: 0.0000</code></pre>
</div>
</div></div>
<div id="d645b178" class="cell markdown">
<p>With <span class="math inline">\(p\)</span>-value &lt; 0.05, we can’t reject the hypothesis that the distribution does not come from the Log-Normal distribution, suggesting Log-Normal is not a good fit for the data. Next, explore other right-skewed distributions - Gamma distribution or the Weibull distribution.</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div id="cell-fig-histogram-gamma" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit gamma distribution using MLE</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gamma, skew, kstest</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>alpha_fit, loc_fit, scale_fit <span class="op">=</span> gamma.fit(data_to_fit) <span class="co"># fit gamma distribution</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the estimated parameters</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Fitted Gamma Distribution Parameters:"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Shape parameter 'alpha': </span><span class="sc">{</span>alpha_fit<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Location parameter 'loc': </span><span class="sc">{</span>loc_fit<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Scale parameter 'scale'): </span><span class="sc">{</span>scale_fit<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the fit</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Histogram of the unemployment data</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>ax.hist(data_to_fit, bins <span class="op">=</span> <span class="dv">20</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, alpha<span class="op">=</span> <span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label <span class="op">=</span> <span class="st">'Data Histogram'</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> ax.get_xlim()</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">## Plot fitted gamma pdf</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> gamma.pdf(x, alpha_fit, loc<span class="op">=</span>loc_fit, scale<span class="op">=</span>scale_fit)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>ax.plot(x, p, <span class="st">'darkred'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Fitted Gamma PDF'</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Unemployment Rate'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Data Histogram vs. Fitted Gamma Distribution PDF"</span>, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Fitted Gamma Distribution Parameters:
  Shape parameter 'alpha': 0.45
  Location parameter 'loc': 3.20
  Scale parameter 'scale'): 1.36</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-histogram-gamma" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Plot the histogram of unemployment rate data and overlay the Probability Density Function (PDF) of the fitted Gamma distribution.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-gamma-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="index_files/figure-html/fig-histogram-gamma-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;6: Unmployment Rate Histogram vs.&nbsp;Fitted Gamma PDF"><img src="index_files/figure-html/fig-histogram-gamma-output-2.png" alt="Plot the histogram of unemployment rate data and overlay the Probability Density Function (PDF) of the fitted Gamma distribution." width="950" height="788" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-gamma-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Unmployment Rate Histogram vs.&nbsp;Fitted Gamma PDF
</figcaption>
</figure>
</div>
</div>
</div></div>
<div id="9d9e1d1e" class="cell markdown">
<p>Although visually the Gamma distribution matches the shape and spread of the actual data. (<a href="#fig-histogram-gamma" class="quarto-xref">Figure&nbsp;6</a>), we need to use KS Test to test Goodness-of-fit by examining the p value.</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div id="9e70c1d0" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the gamma </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>d_statistic, p_value <span class="op">=</span> kstest(data_to_fit, <span class="kw">lambda</span> x: gamma.cdf(x, alpha_fit, loc<span class="op">=</span>loc_fit, scale<span class="op">=</span>scale_fit))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Kolmogorov-Smirnov Test Results:"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  D-statistic: </span><span class="sc">{</span>d_statistic<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Kolmogorov-Smirnov Test Results:
  D-statistic: 0.2699
  P-value: 0.0000</code></pre>
</div>
</div></div>
<div id="d554b895" class="cell markdown">
<p>Again, with <span class="math inline">\(p\)</span>-value &lt; 0.05, we can not confidently say that the data comes from the Gamma distribution. Next, explore Weibull distribution.</p>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div id="cell-fig-histogram-weibull" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Weibull distribution using MLE</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> weibull_min, skew, kstest</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.special <span class="im">import</span> gamma <span class="im">as</span> gamma_func <span class="co"># For Weibull mean calculation</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>c_fit, loc_fit, scale_fit <span class="op">=</span> weibull_min.fit(data_to_fit) <span class="co"># fit weibull distribution</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the estimated parameters</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"\nFitted Weibull Distribution Parameters:")</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  Shape parameter 'c' (k): {c_fit:.4f}")</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  Location parameter (loc): {loc_fit:.4f}")</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  Scale parameter (scale, lambda): {scale_fit:.4f}")</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the fit</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Histogram of the unemployment data</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>ax.hist(data_to_fit, bins <span class="op">=</span> <span class="dv">20</span>, density<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">'skyblue'</span>, alpha<span class="op">=</span> <span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label <span class="op">=</span> <span class="st">'Data Histogram'</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> ax.get_xlim()</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">## Plot fitted gamma pdf</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> weibull_min.pdf(x, c_fit, loc<span class="op">=</span>loc_fit, scale<span class="op">=</span>scale_fit)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>ax.plot(x, p, <span class="st">'darkred'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Fitted Weibull PDF'</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Unemployment Rate'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Data Histogram vs. Fitted Weibull Distribution PDF"</span>, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-histogram-weibull" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Plot the histogram of unemployment rate data and overlay the Probability Density Function (PDF) of the fitted Weibull distribution.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-histogram-weibull-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="index_files/figure-html/fig-histogram-weibull-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Figure&nbsp;7: Unmployment Rate Histogram vs.&nbsp;Fitted Weibull PDF"><img src="index_files/figure-html/fig-histogram-weibull-output-1.png" alt="Plot the histogram of unemployment rate data and overlay the Probability Density Function (PDF) of the fitted Weibull distribution." width="950" height="788" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogram-weibull-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Unmployment Rate Histogram vs.&nbsp;Fitted Weibull PDF
</figcaption>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div id="8e5f3a80" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Weibull</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>d_statistic, p_value <span class="op">=</span> kstest(data_to_fit, <span class="kw">lambda</span> x: weibull_min.cdf(x, c_fit, loc<span class="op">=</span>loc_fit, scale<span class="op">=</span>scale_fit))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate inferred mean</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>fitted_mean <span class="op">=</span> loc_fit <span class="op">+</span> scale_fit <span class="op">*</span> gamma_func(<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>c_fit)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"\nKolmogorov-Smirnov Test Results:")</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  D-statistic: {d_statistic:.4f}")</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"  P-value: {p_value:.4f}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div class="cell" data-tbl-center="true" data-tbl-col="true" data-execution_count="16">

<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the Weibull stats</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>weibull_stats <span class="op">=</span> {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Parameters"</span>: [</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Shape (c)"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Location (loc)"</span> ,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Scale"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_statistics"</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"P-value"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Fitted Mean"</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Values"</span>: [</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>     <span class="bu">round</span>(c_fit, <span class="dv">4</span>),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>     <span class="bu">round</span>(loc_fit, <span class="dv">4</span>),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>     <span class="bu">round</span>(scale_fit, <span class="dv">4</span>),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>     <span class="bu">round</span>(d_statistic, <span class="dv">4</span>),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>     <span class="bu">round</span>(p_value, <span class="dv">4</span>),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>     <span class="bu">round</span>(fitted_mean, <span class="dv">2</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>weibull_stats_table <span class="op">=</span> pd.DataFrame(weibull_stats)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>display(weibull_stats_table.style.hide(axis<span class="op">=</span><span class="st">"index"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-weibull-params" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-center="true" data-tbl-col="true" data-execution_count="16">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-weibull-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Weibull Distribution and Fitness Statistics
</figcaption>
<div aria-describedby="tbl-weibull-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<style type="text/css">
</style>

<table id="T_7b07b" class="do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th id="T_7b07b_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Parameters</th>
<th id="T_7b07b_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_7b07b_row0_col0" class="data row0 col0">Shape (c)</td>
<td id="T_7b07b_row0_col1" class="data row0 col1">0.709400</td>
</tr>
<tr class="even">
<td id="T_7b07b_row1_col0" class="data row1 col0">Location (loc)</td>
<td id="T_7b07b_row1_col1" class="data row1 col1">3.200000</td>
</tr>
<tr class="odd">
<td id="T_7b07b_row2_col0" class="data row2 col0">Scale</td>
<td id="T_7b07b_row2_col1" class="data row2 col1">0.920400</td>
</tr>
<tr class="even">
<td id="T_7b07b_row3_col0" class="data row3 col0">D_statistics</td>
<td id="T_7b07b_row3_col1" class="data row3 col1">0.104700</td>
</tr>
<tr class="odd">
<td id="T_7b07b_row4_col0" class="data row4 col0">P-value</td>
<td id="T_7b07b_row4_col1" class="data row4 col1">0.117300</td>
</tr>
<tr class="even">
<td id="T_7b07b_row5_col0" class="data row5 col0">Fitted Mean</td>
<td id="T_7b07b_row5_col1" class="data row5 col1">4.350000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div></div></div>
</div></div>
<div id="14a9d1e3" class="cell markdown">
<p>The overlayed smooth PDF curve on top of original data’s histogram <a href="#fig-histogram-weibull" class="quarto-xref">Figure&nbsp;7</a> suggests that the Weibull distribution matches the distribution of the actual data. The results of the Weibull distribution, summarized in Table <a href="#tbl-weibull-params" class="quarto-xref">Table&nbsp;4</a>, including the shape, location, and scale parameters, along with the D-statistic, P-value, and fitted mean also proves Weibull distribution is a good fit, supported by a KS test p-value of 0.1173 (greater than 0.05). The estimated parameters (c=0.7093, loc=3.2000, scale=0.9204) align well with the spread of the data. Shape (c&lt;1): Confirms the strong right-skewness of the data. Location (loc=3.2000): Indicates the distribution starts around 3.20, matching data’s lower bound. Inferred Mean: The calculated mean of approximately 4.35 from these parameters is close but slightly higher than the data’s actual mean of around 4, showing a good capture of central tendency.</p>
<section id="define-the-prior-means-for-overall-population" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="define-the-prior-means-for-overall-population"><span class="header-section-number">4.2</span> Define the prior means for overall population</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">### population unemployment mean probability from the fitted Weibull distribution</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>weibull_fitted_mean_prob <span class="op">=</span> <span class="fl">0.0435</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the fitted mean probability to its log-odds equivalent in order to model binary outcome with logistic regression</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>population_mean_log_odds <span class="op">=</span> np.log(weibull_fitted_mean_prob <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> weibull_fitted_mean_prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [17]:</pre></div><div id="63e91ccf" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">### population unemployment mean probability from the fitted Weibull distribution</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>weibull_fitted_mean_prob <span class="op">=</span> <span class="fl">0.0435</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the fitted mean probability to its log-odds equivalent in order to model binary outcome with logistic regression</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>population_mean_log_odds <span class="op">=</span> np.log(weibull_fitted_mean_prob <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> weibull_fitted_mean_prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div id="13d7d980" class="cell markdown">
<section id="define-the-prior-means-by-races" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="define-the-prior-means-by-races"><span class="header-section-number">4.3</span> Define the prior means by races</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to find the means of different demographics</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_prob_demographic(df_name, demographic_type, demographic_description):</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    demographic_mean_prob <span class="op">=</span> df_dic[df_name].loc[df_dic[df_name][demographic_type]<span class="op">==</span>demographic_description][<span class="st">'Unemployment_rate'</span>].mean()<span class="op">/</span><span class="dv">100</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    demographic_mean_log_odds <span class="op">=</span> np.log(demographic_mean_prob <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> demographic_mean_prob))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># beta_effect is the difference between the demographic group mean log-odds and the population mean log-odds</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    beta_effect <span class="op">=</span> demographic_mean_log_odds <span class="op">-</span> population_mean_log_odds</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> beta_effect</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grid of demographic information to return the means</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>demographic_grid <span class="op">=</span> pd.DataFrame({</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df_name"</span>:[</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Race'</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Race'</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Race'</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"demographic_type"</span>:[</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Race"</span>, </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Race"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Race"</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"demographic_description"</span>:[</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'black_and_african'</span>,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'white'</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'asian'</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the beta_effect of different demographics</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>demographic_grid[<span class="st">'beta_effect'</span>]<span class="op">=</span> np.float64(<span class="dv">0</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(demographic_grid)):</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean of demographic groups</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    beta_effect <span class="op">=</span> mean_prob_demographic(demographic_grid[<span class="st">'df_name'</span>][row], demographic_grid[<span class="st">'demographic_type'</span>][row], demographic_grid[<span class="st">'demographic_description'</span>][row])</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    demographic_grid[<span class="st">'beta_effect'</span>][row] <span class="op">=</span> beta_effect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [18]:</pre></div><div id="eeba6570" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to find the means of different demographics</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_prob_demographic(df_name, demographic_type, demographic_description):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    demographic_mean_prob <span class="op">=</span> df_dic[df_name].loc[df_dic[df_name][demographic_type]<span class="op">==</span>demographic_description][<span class="st">'Unemployment_rate'</span>].mean()<span class="op">/</span><span class="dv">100</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    demographic_mean_log_odds <span class="op">=</span> np.log(demographic_mean_prob <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> demographic_mean_prob))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># beta_effect is the difference between the demographic group mean log-odds and the population mean log-odds</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    beta_effect <span class="op">=</span> demographic_mean_log_odds <span class="op">-</span> population_mean_log_odds</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> beta_effect</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grid of demographic information to return the means</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>demographic_grid <span class="op">=</span> pd.DataFrame({</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"df_name"</span>:[</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Race'</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Race'</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Race'</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"demographic_type"</span>:[</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Race"</span>, </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Race"</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Race"</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"demographic_description"</span>:[</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'black_and_african'</span>,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'white'</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'asian'</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the beta_effect of different demographics</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>demographic_grid[<span class="st">'beta_effect'</span>]<span class="op">=</span> np.float64(<span class="dv">0</span>)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="bu">len</span>(demographic_grid)):</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean of demographic groups</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    beta_effect <span class="op">=</span> mean_prob_demographic(demographic_grid[<span class="st">'df_name'</span>][row], demographic_grid[<span class="st">'demographic_type'</span>][row], demographic_grid[<span class="st">'demographic_description'</span>][row])</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    demographic_grid[<span class="st">'beta_effect'</span>][row] <span class="op">=</span> beta_effect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div id="c05e054f" class="cell markdown">
<section id="define-the-unemployment-race-pymc" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="define-the-unemployment-race-pymc"><span class="header-section-number">4.4</span> Define the unemployment-race PyMC</h3>
<p>This section sets up the Bayesian model to estimate the additive race effect relative to the fixed baseline.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the pymc model</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> unemployment_race_model:</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prior of population mean log odds</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    mu_population_log_odds <span class="op">=</span> pm.Normal(<span class="st">'mu_population_log_odds'</span>, mu<span class="op">=</span>population_mean_log_odds, sigma<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additive race effect parameter on population mean</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    beta_black <span class="op">=</span> pm.Normal(<span class="st">'beta_black'</span>, mu<span class="op">=</span>demographic_grid[demographic_grid[<span class="st">'demographic_description'</span>]<span class="op">==</span><span class="st">'black_and_african'</span>][<span class="st">'beta_effect'</span>], sigma<span class="op">=</span><span class="fl">0.3</span>) <span class="co"># Can be positive or negative</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    beta_asian <span class="op">=</span> pm.Normal(<span class="st">'beta_asian'</span>, mu<span class="op">=</span>demographic_grid[demographic_grid[<span class="st">'demographic_description'</span>]<span class="op">==</span><span class="st">'asian'</span>][<span class="st">'beta_effect'</span>], sigma<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    beta_white <span class="op">=</span> pm.Normal(<span class="st">'beta_white'</span>, mu<span class="op">=</span>demographic_grid[demographic_grid[<span class="st">'demographic_description'</span>]<span class="op">==</span><span class="st">'white'</span>][<span class="st">'beta_effect'</span>], sigma<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># noise</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> pm.HalfNormal(<span class="st">'sigma'</span>, sigma<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># log-odds and probabilities for each racial group</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    mu_white_log_odds <span class="op">=</span> pm.Deterministic(<span class="st">'mu_white_log_odds'</span>, mu_population_log_odds <span class="op">+</span> beta_white)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    mu_black_log_odds <span class="op">=</span> pm.Deterministic(<span class="st">'mu_black_log_odds'</span>, mu_population_log_odds <span class="op">+</span> beta_black)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    mu_asian_log_odds <span class="op">=</span> pm.Deterministic(<span class="st">'mu_asian_log_odds'</span>, mu_population_log_odds <span class="op">+</span> beta_asian)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    p_population <span class="op">=</span> pm.Deterministic(<span class="st">'p_population'</span>, pm.math.invlogit(mu_population_log_odds))</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    p_white <span class="op">=</span> pm.Deterministic(<span class="st">'p_white'</span>, pm.math.invlogit(mu_white_log_odds))</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    p_black <span class="op">=</span> pm.Deterministic(<span class="st">'p_black'</span>, pm.math.invlogit(mu_black_log_odds))</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    p_asian <span class="op">=</span> pm.Deterministic(<span class="st">'p_asian'</span>, pm.math.invlogit(mu_asian_log_odds))</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Likelihoods for observed data: use parameters like derived above to make predictions about the "true" probabilities of unemployment.</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict population mean</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    population_rates_df <span class="op">=</span> df_overall_long[<span class="op">~</span>np.isnan(df_overall_long[<span class="st">'Unemployment_rate'</span>])]</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    population_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(population_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>population_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    population_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'population_rates_obs'</span>,</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_population_log_odds, </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>population_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict black mean</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    black_rates_df <span class="op">=</span> df_dic[<span class="st">'Race'</span>][df_dic[<span class="st">'Race'</span>][<span class="st">'Race'</span>]<span class="op">==</span><span class="st">'black_and_african'</span>]</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    black_rates_df <span class="op">=</span> black_rates_df[<span class="op">~</span>np.isnan(black_rates_df[<span class="st">'Unemployment_rate'</span>])] </span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    black_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(black_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>black_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    black_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'black_rates_obs'</span>,</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_black_log_odds, </span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>black_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict asian mean</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>    asian_rates_df <span class="op">=</span> df_dic[<span class="st">'Race'</span>][df_dic[<span class="st">'Race'</span>][<span class="st">'Race'</span>]<span class="op">==</span><span class="st">'asian'</span>]</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>    asian_rates_df <span class="op">=</span> asian_rates_df[<span class="op">~</span>np.isnan(asian_rates_df[<span class="st">'Unemployment_rate'</span>])] </span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>    asian_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(asian_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>asian_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>    asian_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'asian_rates_obs'</span>,</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_asian_log_odds,</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>asian_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict white mean</span></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>    white_rates_df <span class="op">=</span> df_dic[<span class="st">'Race'</span>][df_dic[<span class="st">'Race'</span>][<span class="st">'Race'</span>]<span class="op">==</span><span class="st">'white'</span>]</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>    white_rates_df <span class="op">=</span> white_rates_df[<span class="op">~</span>np.isnan(white_rates_df[<span class="st">'Unemployment_rate'</span>])] </span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>    white_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(white_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>white_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>    white_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'white_rates_obs'</span>,</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_white_log_odds,</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>white_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign the correct probability based on race</span></span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>    p_individual_for_obs <span class="op">=</span> pm.math.switch(</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>        df_survey_jun[<span class="st">'is_black_african'</span>].values,</span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>        p_black, <span class="co"># if is_black, use black prob</span></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>        pm.math.switch(</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>            df_survey_jun[<span class="st">'is_asian'</span>].values, </span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>            p_asian, <span class="co"># if is_asian, use asian prob</span></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>            p_white <span class="co"># else, use white prob</span></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>    individual_status_obs <span class="op">=</span> pm.Bernoulli(</span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'individual_status_obs'</span>,</span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span>p_individual_for_obs,</span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>df_survey_jun[<span class="st">'unemployment_status'</span>].values</span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [19]:</pre></div><div id="56302eb9" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the pymc model</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model() <span class="im">as</span> unemployment_race_model:</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prior of population mean log odds</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    mu_population_log_odds <span class="op">=</span> pm.Normal(<span class="st">'mu_population_log_odds'</span>, mu<span class="op">=</span>population_mean_log_odds, sigma<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additive race effect parameter on population mean</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    beta_black <span class="op">=</span> pm.Normal(<span class="st">'beta_black'</span>, mu<span class="op">=</span>demographic_grid[demographic_grid[<span class="st">'demographic_description'</span>]<span class="op">==</span><span class="st">'black_and_african'</span>][<span class="st">'beta_effect'</span>], sigma<span class="op">=</span><span class="fl">0.3</span>) <span class="co"># Can be positive or negative</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    beta_asian <span class="op">=</span> pm.Normal(<span class="st">'beta_asian'</span>, mu<span class="op">=</span>demographic_grid[demographic_grid[<span class="st">'demographic_description'</span>]<span class="op">==</span><span class="st">'asian'</span>][<span class="st">'beta_effect'</span>], sigma<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    beta_white <span class="op">=</span> pm.Normal(<span class="st">'beta_white'</span>, mu<span class="op">=</span>demographic_grid[demographic_grid[<span class="st">'demographic_description'</span>]<span class="op">==</span><span class="st">'white'</span>][<span class="st">'beta_effect'</span>], sigma<span class="op">=</span><span class="fl">0.3</span>) </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># noise</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> pm.HalfNormal(<span class="st">'sigma'</span>, sigma<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># log-odds and probabilities for each racial group</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    mu_white_log_odds <span class="op">=</span> pm.Deterministic(<span class="st">'mu_white_log_odds'</span>, mu_population_log_odds <span class="op">+</span> beta_white)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    mu_black_log_odds <span class="op">=</span> pm.Deterministic(<span class="st">'mu_black_log_odds'</span>, mu_population_log_odds <span class="op">+</span> beta_black)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    mu_asian_log_odds <span class="op">=</span> pm.Deterministic(<span class="st">'mu_asian_log_odds'</span>, mu_population_log_odds <span class="op">+</span> beta_asian)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    p_population <span class="op">=</span> pm.Deterministic(<span class="st">'p_population'</span>, pm.math.invlogit(mu_population_log_odds))</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    p_white <span class="op">=</span> pm.Deterministic(<span class="st">'p_white'</span>, pm.math.invlogit(mu_white_log_odds))</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    p_black <span class="op">=</span> pm.Deterministic(<span class="st">'p_black'</span>, pm.math.invlogit(mu_black_log_odds))</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    p_asian <span class="op">=</span> pm.Deterministic(<span class="st">'p_asian'</span>, pm.math.invlogit(mu_asian_log_odds))</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Likelihoods for observed data: use parameters like derived above to make predictions about the "true" probabilities of unemployment.</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict population mean</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    population_rates_df <span class="op">=</span> df_overall_long[<span class="op">~</span>np.isnan(df_overall_long[<span class="st">'Unemployment_rate'</span>])]</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    population_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(population_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>population_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    population_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'population_rates_obs'</span>,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_population_log_odds, </span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>population_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict black mean</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    black_rates_df <span class="op">=</span> df_dic[<span class="st">'Race'</span>][df_dic[<span class="st">'Race'</span>][<span class="st">'Race'</span>]<span class="op">==</span><span class="st">'black_and_african'</span>]</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    black_rates_df <span class="op">=</span> black_rates_df[<span class="op">~</span>np.isnan(black_rates_df[<span class="st">'Unemployment_rate'</span>])] </span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    black_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(black_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>black_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    black_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'black_rates_obs'</span>,</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_black_log_odds, </span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>black_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict asian mean</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    asian_rates_df <span class="op">=</span> df_dic[<span class="st">'Race'</span>][df_dic[<span class="st">'Race'</span>][<span class="st">'Race'</span>]<span class="op">==</span><span class="st">'asian'</span>]</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>    asian_rates_df <span class="op">=</span> asian_rates_df[<span class="op">~</span>np.isnan(asian_rates_df[<span class="st">'Unemployment_rate'</span>])] </span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>    asian_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(asian_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>asian_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    asian_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'asian_rates_obs'</span>,</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_asian_log_odds,</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>asian_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predict white mean</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>    white_rates_df <span class="op">=</span> df_dic[<span class="st">'Race'</span>][df_dic[<span class="st">'Race'</span>][<span class="st">'Race'</span>]<span class="op">==</span><span class="st">'white'</span>]</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>    white_rates_df <span class="op">=</span> white_rates_df[<span class="op">~</span>np.isnan(white_rates_df[<span class="st">'Unemployment_rate'</span>])] </span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>    white_rates_df[<span class="st">'rate_logit'</span>] <span class="op">=</span> np.log(white_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>white_rates_df[<span class="st">'Unemployment_rate'</span>]<span class="op">*</span><span class="fl">0.01</span>))</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>    white_rates_obs <span class="op">=</span> pm.Normal(</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'white_rates_obs'</span>,</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>        mu<span class="op">=</span>mu_white_log_odds,</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>        sigma<span class="op">=</span>sigma,</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>white_rates_df[<span class="st">'rate_logit'</span>].values</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign the correct probability based on race</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>    p_individual_for_obs <span class="op">=</span> pm.math.switch(</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>        df_survey_jun[<span class="st">'is_black_african'</span>].values,</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>        p_black, <span class="co"># if is_black, use black prob</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>        pm.math.switch(</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>            df_survey_jun[<span class="st">'is_asian'</span>].values, </span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>            p_asian, <span class="co"># if is_asian, use asian prob</span></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>            p_white <span class="co"># else, use white prob</span></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>    individual_status_obs <span class="op">=</span> pm.Bernoulli(</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'individual_status_obs'</span>,</span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>        p<span class="op">=</span>p_individual_for_obs,</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>        observed<span class="op">=</span>df_survey_jun[<span class="st">'unemployment_status'</span>].values</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div id="18ebf66c" class="cell markdown">
<section id="graph-the-unemployment-race-pgm" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="graph-the-unemployment-race-pgm"><span class="header-section-number">4.5</span> Graph the unemployment-race PGM</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pm.model_to_graphviz(unemployment_race_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [20]:</pre></div><div id="c1b2f429" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pm.model_to_graphviz(unemployment_race_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/cell-21-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="index_files/figure-html/cell-21-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div id="4835261e" class="cell markdown">
<section id="fit-the-unemployment-race-model---perform-mcmc-sampling" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="fit-the-unemployment-race-model---perform-mcmc-sampling"><span class="header-section-number">4.6</span> Fit the unemployment-race Model - Perform MCMC Sampling</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Starting MCMC sampling..."</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> unemployment_race_model:</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    indiv_trace <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">5650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [21]:</pre></div><div id="28a4e0c7" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Starting MCMC sampling..."</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> unemployment_race_model:</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    indiv_trace <span class="op">=</span> pm.sample(random_seed<span class="op">=</span><span class="dv">5650</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting MCMC sampling...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [mu_population_log_odds, beta_black, beta_asian, beta_white, sigma]</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"f52eb5559a1548189c7c46c9cea1d134","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 13 seconds.</code></pre>
</div>
</div></div>
<div id="c3ea467e" class="cell markdown">
<section id="analyze-unemployment-race-results-and-visualize" class="level3" data-number="4.7">
<h3 data-number="4.7" class="anchored" data-anchor-id="analyze-unemployment-race-results-and-visualize"><span class="header-section-number">4.7</span> Analyze unemployment-race Results and Visualize</h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze Results and Visualize</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Model Summary (Simplified Model - Multiple Races) ---"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>display(pd.DataFrame(az.summary(indiv_trace, var_names<span class="op">=</span>[<span class="st">'mu_population_log_odds'</span>, <span class="st">'beta_black'</span>, <span class="st">'beta_asian'</span>, <span class="st">'beta_white'</span>, <span class="st">'sigma'</span>])))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace plot</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>fig_trace <span class="op">=</span> az.plot_trace(indiv_trace)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Trace plot'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">0.5</span>) </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>indiv_post_df <span class="op">=</span> indiv_trace.posterior.to_dataframe().reset_index()</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract only the first chain</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>indiv_post_df <span class="op">=</span> indiv_post_df[indiv_post_df[<span class="st">'chain'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>indiv_post_df <span class="op">=</span> indiv_post_df[[<span class="st">'draw'</span>,<span class="st">'beta_black'</span>, <span class="st">'beta_asian'</span>, <span class="st">'beta_white'</span>]].melt(id_vars<span class="op">=</span>[<span class="st">'draw'</span>])</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plot</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> patchworklib <span class="im">as</span> pw</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="fl">2.5</span>))<span class="op">;</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"value"</span>, hue<span class="op">=</span><span class="st">"variable"</span>, data<span class="op">=</span>indiv_post_df, ax<span class="op">=</span>ax,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="va">True</span>, bw_adjust<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Log-Odds Deviation from Overall Mean"</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Posterior Distribution of Race Effect Deviations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [22]:</pre></div><div id="da172b8c" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze Results and Visualize</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Model Summary (Simplified Model - Multiple Races) ---"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>display(pd.DataFrame(az.summary(indiv_trace, var_names<span class="op">=</span>[<span class="st">'mu_population_log_odds'</span>, <span class="st">'beta_black'</span>, <span class="st">'beta_asian'</span>, <span class="st">'beta_white'</span>, <span class="st">'sigma'</span>])))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace plot</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>fig_trace <span class="op">=</span> az.plot_trace(indiv_trace)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Trace plot'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">0.5</span>) </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>indiv_post_df <span class="op">=</span> indiv_trace.posterior.to_dataframe().reset_index()</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract only the first chain</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>indiv_post_df <span class="op">=</span> indiv_post_df[indiv_post_df[<span class="st">'chain'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Melt</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>indiv_post_df <span class="op">=</span> indiv_post_df[[<span class="st">'draw'</span>,<span class="st">'beta_black'</span>, <span class="st">'beta_asian'</span>, <span class="st">'beta_white'</span>]].melt(id_vars<span class="op">=</span>[<span class="st">'draw'</span>])</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plot</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> patchworklib <span class="im">as</span> pw</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pw.Brick(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="fl">2.5</span>))<span class="op">;</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"value"</span>, hue<span class="op">=</span><span class="st">"variable"</span>, data<span class="op">=</span>indiv_post_df, ax<span class="op">=</span>ax,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="va">True</span>, bw_adjust<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Log-Odds Deviation from Overall Mean"</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Density"</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Posterior Distribution of Race Effect Deviations"</span>)</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>ax.savefig()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Model Summary (Simplified Model - Multiple Races) ---</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
<th data-quarto-table-cell-role="th">mcse_mean</th>
<th data-quarto-table-cell-role="th">mcse_sd</th>
<th data-quarto-table-cell-role="th">ess_bulk</th>
<th data-quarto-table-cell-role="th">ess_tail</th>
<th data-quarto-table-cell-role="th">r_hat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">mu_population_log_odds</td>
<td>-3.146</td>
<td>0.028</td>
<td>-3.199</td>
<td>-3.093</td>
<td>0.001</td>
<td>0.000</td>
<td>1539.0</td>
<td>1941.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">beta_black[0]</td>
<td>0.565</td>
<td>0.038</td>
<td>0.497</td>
<td>0.640</td>
<td>0.001</td>
<td>0.001</td>
<td>1845.0</td>
<td>2677.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">beta_asian[0]</td>
<td>-0.149</td>
<td>0.039</td>
<td>-0.218</td>
<td>-0.075</td>
<td>0.001</td>
<td>0.001</td>
<td>1859.0</td>
<td>2245.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">beta_white[0]</td>
<td>-0.128</td>
<td>0.034</td>
<td>-0.191</td>
<td>-0.065</td>
<td>0.001</td>
<td>0.000</td>
<td>1772.0</td>
<td>2332.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">sigma</td>
<td>0.320</td>
<td>0.010</td>
<td>0.301</td>
<td>0.340</td>
<td>0.000</td>
<td>0.000</td>
<td>3604.0</td>
<td>2570.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-23-output-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/cell-23-output-3.png" width="454" height="326" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-23-output-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="index_files/figure-html/cell-23-output-4.png" width="924" height="2045" class="figure-img"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/cell-23-output-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="index_files/figure-html/cell-23-output-5.png" width="454" height="326" class="figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div id="deda0437" class="cell markdown">
<p>The posterior distributions of racial group mean log-odds for unemployment reveal clear deviations, with the Black population exhibiting a higher rate compared to both the White and Asian populations.</p>
<section id="pgm-for-unemployment-industry" class="level3" data-number="4.8">
<h3 data-number="4.8" class="anchored" data-anchor-id="pgm-for-unemployment-industry"><span class="header-section-number">4.8</span> PGM for unemployment-industry</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 1. Exclude some industries and persons "not in labor force" and industries that don't have historical unemployment stats</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>survey_df_industry <span class="op">=</span> survey_df[<span class="op">~</span>survey_df[<span class="st">'industry_name'</span>].isin([<span class="st">'Construction'</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Mining'</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Other services'</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Agriculture, forestry, fishing, and hunting'</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Armed Forces'</span>])]</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>survey_df_industry <span class="op">=</span> survey_df_industry[survey_df_industry[<span class="st">'employment_status_description'</span>]<span class="op">!=</span><span class="st">"not in labor force"</span>]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Factorize the industry_name column to get numerical indices and names</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>industry_idx, industry_names <span class="op">=</span> survey_df_industry[<span class="st">'industry_name'</span>].factorize()</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>survey_df_industry[<span class="st">'industry_idx'</span>] <span class="op">=</span> industry_idx</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Map EmploymentStatus to numerical (0 for Employed, 1 for Unemployed)</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>survey_df_industry[<span class="st">'unemployment_status'</span>] <span class="op">=</span> survey_df_industry[<span class="st">'employment_status_description'</span>].<span class="bu">map</span>({<span class="st">'employed'</span>: <span class="dv">0</span>, <span class="st">'unemployed'</span>: <span class="dv">1</span>})</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 2. Get the prior means and sds of unemployment rates by industries from the historical monthly statistics (exlcuding 2020-2021)</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>df_industry_monthly_ur <span class="op">=</span> df_industry[<span class="op">~</span>df_industry[<span class="st">'Industry'</span>].isin([<span class="st">'construction'</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'mining_quarrying_and_oil_and_gas_ extraction'</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'other_services'</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'agricultural'</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'self_employed'</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'non_durable_goods'</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'durable_goods'</span>])]</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>ur_by_industry <span class="op">=</span> pd.DataFrame(df_industry_monthly_ur.groupby(<span class="st">'Industry'</span>, as_index<span class="op">=</span><span class="va">False</span>).agg(</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    mean_ur <span class="op">=</span> (<span class="st">'Unemployment_rate'</span>,<span class="st">'mean'</span>),</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    sd_ur <span class="op">=</span> (<span class="st">'Unemployment_rate'</span>, <span class="st">'std'</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a> <span class="co"># modify the industry name column to align with industry_names</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>ur_by_industry[<span class="st">'Industry'</span>]<span class="op">=</span>[<span class="st">'Educational and health services'</span>,</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Financial activities'</span>,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Public administration'</span>,</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Information'</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Leisure and hospitality'</span>,</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Manufacturing'</span>,</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Professional and business services'</span>,</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Transportation and utilities'</span>,</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Wholesale and retail trade'</span>]</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Logit transformation function</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> logit(p):</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.log(p <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> p))</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>ur_by_industry[<span class="st">'mean_ur_logit'</span>] <span class="op">=</span> logit(ur_by_industry[<span class="st">'mean_ur'</span>]<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>ur_by_industry[<span class="st">'sd_ur_logit'</span>] <span class="op">=</span> logit(ur_by_industry[<span class="st">'sd_ur'</span>]<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a><span class="co">## 3. Define the Adaptive pooling PyMC model</span></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a><span class="co"># priors</span></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>ur_by_industry_copy <span class="op">=</span> ur_by_industry.copy()</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>ur_by_industry_copy <span class="op">=</span> ur_by_industry_copy.set_index(<span class="st">'Industry'</span>)</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>prior_mu_alpha_vals <span class="op">=</span> np.array([ur_by_industry_copy.loc[ind, <span class="st">'mean_ur_logit'</span>] <span class="cf">for</span> ind <span class="kw">in</span> industry_names])</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>prior_sigma_alpha_vals <span class="op">=</span> np.array([ur_by_industry_copy.loc[ind, <span class="st">'sd_ur_logit'</span>] <span class="cf">for</span> ind <span class="kw">in</span> industry_names])</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the PGM model</span></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> {<span class="st">"industry"</span>: industry_names}</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> adaptive_unemployment_industry_model:</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>    industry_idx_obs <span class="op">=</span> pm.Data(<span class="st">"industry_idx_obs"</span>, survey_df_industry[<span class="st">'industry_idx'</span>].values, dims<span class="op">=</span><span class="st">"obs_id"</span>)</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Global Priors </span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> pm.Exponential(<span class="st">"sigma"</span>, <span class="dv">1</span>) <span class="co"># standard deviation for alpha_industry</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Industry-Specific Parameters - observed industry means</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>    mu_alpha_industry <span class="op">=</span> pm.Data(<span class="st">"mu_alpha_industry"</span>, prior_mu_alpha_vals, dims<span class="op">=</span><span class="st">"industry"</span>) <span class="co"># history industry means</span></span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>    alpha_industry <span class="op">=</span> pm.Normal(<span class="st">"alpha_industry"</span>, </span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>                                mu<span class="op">=</span>mu_alpha_industry, <span class="co"># historical industry means</span></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>                                sigma<span class="op">=</span>sigma,</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>                                dims<span class="op">=</span><span class="st">"industry"</span>)</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Probability of unemployment of each industry determined by alpha_industry</span></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>    p_unemployment <span class="op">=</span> pm.Deterministic(<span class="st">"p_unemployment"</span>, pm.invlogit(alpha_industry[industry_idx_obs]))</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Observed data - unemployment status</span></span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>    unemployment_status_observed <span class="op">=</span> pm.Bernoulli(<span class="st">"unemployment_status"</span>, </span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>                                            p<span class="op">=</span>p_unemployment, </span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>                                            observed<span class="op">=</span>survey_df_industry[<span class="st">'unemployment_status'</span>].values,</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>                                            dims<span class="op">=</span><span class="st">"obs_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [23]:</pre></div><div id="72a30b67" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 1. Exclude some industries and persons "not in labor force" and industries that don't have historical unemployment stats</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>survey_df_industry <span class="op">=</span> survey_df[<span class="op">~</span>survey_df[<span class="st">'industry_name'</span>].isin([<span class="st">'Construction'</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Mining'</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Other services'</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Agriculture, forestry, fishing, and hunting'</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'Armed Forces'</span>])]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>survey_df_industry <span class="op">=</span> survey_df_industry[survey_df_industry[<span class="st">'employment_status_description'</span>]<span class="op">!=</span><span class="st">"not in labor force"</span>]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Factorize the industry_name column to get numerical indices and names</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>industry_idx, industry_names <span class="op">=</span> survey_df_industry[<span class="st">'industry_name'</span>].factorize()</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>survey_df_industry[<span class="st">'industry_idx'</span>] <span class="op">=</span> industry_idx</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Map EmploymentStatus to numerical (0 for Employed, 1 for Unemployed)</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>survey_df_industry[<span class="st">'unemployment_status'</span>] <span class="op">=</span> survey_df_industry[<span class="st">'employment_status_description'</span>].<span class="bu">map</span>({<span class="st">'employed'</span>: <span class="dv">0</span>, <span class="st">'unemployed'</span>: <span class="dv">1</span>})</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">## 2. Get the prior means and sds of unemployment rates by industries from the historical monthly statistics (exlcuding 2020-2021)</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>df_industry_monthly_ur <span class="op">=</span> df_industry[<span class="op">~</span>df_industry[<span class="st">'Industry'</span>].isin([<span class="st">'construction'</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'mining_quarrying_and_oil_and_gas_ extraction'</span>,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'other_services'</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'agricultural'</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'self_employed'</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'non_durable_goods'</span>,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'durable_goods'</span>])]</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>ur_by_industry <span class="op">=</span> pd.DataFrame(df_industry_monthly_ur.groupby(<span class="st">'Industry'</span>, as_index<span class="op">=</span><span class="va">False</span>).agg(</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    mean_ur <span class="op">=</span> (<span class="st">'Unemployment_rate'</span>,<span class="st">'mean'</span>),</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    sd_ur <span class="op">=</span> (<span class="st">'Unemployment_rate'</span>, <span class="st">'std'</span>)</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a> <span class="co"># modify the industry name column to align with industry_names</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>ur_by_industry[<span class="st">'Industry'</span>]<span class="op">=</span>[<span class="st">'Educational and health services'</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Financial activities'</span>,</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Public administration'</span>,</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Information'</span>,</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Leisure and hospitality'</span>,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Manufacturing'</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Professional and business services'</span>,</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Transportation and utilities'</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Wholesale and retail trade'</span>]</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Logit transformation function</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> logit(p):</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.log(p <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> p))</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>ur_by_industry[<span class="st">'mean_ur_logit'</span>] <span class="op">=</span> logit(ur_by_industry[<span class="st">'mean_ur'</span>]<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>ur_by_industry[<span class="st">'sd_ur_logit'</span>] <span class="op">=</span> logit(ur_by_industry[<span class="st">'sd_ur'</span>]<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="co">## 3. Define the Adaptive pooling PyMC model</span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="co"># priors</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>ur_by_industry_copy <span class="op">=</span> ur_by_industry.copy()</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>ur_by_industry_copy <span class="op">=</span> ur_by_industry_copy.set_index(<span class="st">'Industry'</span>)</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>prior_mu_alpha_vals <span class="op">=</span> np.array([ur_by_industry_copy.loc[ind, <span class="st">'mean_ur_logit'</span>] <span class="cf">for</span> ind <span class="kw">in</span> industry_names])</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>prior_sigma_alpha_vals <span class="op">=</span> np.array([ur_by_industry_copy.loc[ind, <span class="st">'sd_ur_logit'</span>] <span class="cf">for</span> ind <span class="kw">in</span> industry_names])</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the PGM model</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>coords <span class="op">=</span> {<span class="st">"industry"</span>: industry_names}</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> adaptive_unemployment_industry_model:</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>    industry_idx_obs <span class="op">=</span> pm.Data(<span class="st">"industry_idx_obs"</span>, survey_df_industry[<span class="st">'industry_idx'</span>].values, dims<span class="op">=</span><span class="st">"obs_id"</span>)</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Global Priors </span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> pm.Exponential(<span class="st">"sigma"</span>, <span class="dv">1</span>) <span class="co"># standard deviation for alpha_industry</span></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Industry-Specific Parameters - observed industry means</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>    mu_alpha_industry <span class="op">=</span> pm.Data(<span class="st">"mu_alpha_industry"</span>, prior_mu_alpha_vals, dims<span class="op">=</span><span class="st">"industry"</span>) <span class="co"># history industry means</span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>    alpha_industry <span class="op">=</span> pm.Normal(<span class="st">"alpha_industry"</span>, </span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>                                mu<span class="op">=</span>mu_alpha_industry, <span class="co"># historical industry means</span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>                                sigma<span class="op">=</span>sigma,</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>                                dims<span class="op">=</span><span class="st">"industry"</span>)</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Probability of unemployment of each industry determined by alpha_industry</span></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>    p_unemployment <span class="op">=</span> pm.Deterministic(<span class="st">"p_unemployment"</span>, pm.invlogit(alpha_industry[industry_idx_obs]))</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Observed data - unemployment status</span></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>    unemployment_status_observed <span class="op">=</span> pm.Bernoulli(<span class="st">"unemployment_status"</span>, </span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>                                            p<span class="op">=</span>p_unemployment, </span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>                                            observed<span class="op">=</span>survey_df_industry[<span class="st">'unemployment_status'</span>].values,</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>                                            dims<span class="op">=</span><span class="st">"obs_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div id="4aaf991e" class="cell markdown">
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 4.Visualize the PGM</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>pm.model_to_graphviz(adaptive_unemployment_industry_model)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [24]:</pre></div><div id="104cd415" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 4.Visualize the PGM</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>display(pm.model_to_graphviz(adaptive_unemployment_industry_model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/cell-25-output-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="index_files/figure-html/cell-25-output-1.svg" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div id="052f76d4" class="cell markdown">
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 5.MCMC sampling and prediction</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> adaptive_unemployment_industry_model:</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    ur_industry_trace <span class="op">=</span> pm.sample(tune <span class="op">=</span> <span class="dv">500</span>, draws<span class="op">=</span><span class="dv">500</span>, random_seed<span class="op">=</span><span class="dv">5650</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pring summary of the trace</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary <span class="op">=</span> az.summary(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    ur_industry_trace,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    var_names<span class="op">=</span>[<span class="st">'alpha_industry'</span>],</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"stats"</span>, </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    round_to<span class="op">=</span><span class="dv">2</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary[<span class="st">'mean'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>trace_alpha_summary[<span class="st">'mean'</span>])) <span class="co"># convert logit to probability</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary[<span class="st">'hdi_3%'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>trace_alpha_summary[<span class="st">'hdi_3%'</span>])) <span class="co"># convert logit to probability</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary[<span class="st">'hdi_97%'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>trace_alpha_summary[<span class="st">'hdi_97%'</span>])) <span class="co"># convert logit to probability</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>display(trace_alpha_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [25]:</pre></div><div id="2436a7c2" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 5.MCMC sampling and prediction</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> adaptive_unemployment_industry_model:</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    ur_industry_trace <span class="op">=</span> pm.sample(tune <span class="op">=</span> <span class="dv">500</span>, draws<span class="op">=</span><span class="dv">500</span>, random_seed<span class="op">=</span><span class="dv">5650</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pring summary of the trace</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary <span class="op">=</span> az.summary(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    ur_industry_trace,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    var_names<span class="op">=</span>[<span class="st">'alpha_industry'</span>],</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"stats"</span>, </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    round_to<span class="op">=</span><span class="dv">2</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [sigma, alpha_industry]</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e8941c71942e4ed0b4d04f1133625cf0","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Sampling 4 chains for 500 tune and 500 draw iterations (2_000 + 2_000 draws total) took 130 seconds.</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [26]:</pre></div><div class="cell" data-tbl-center="true" data-tbl-col="true" data-execution_count="26">

<div class="cell-container"><div class="cell-decorator"><pre>In [26]:</pre></div><div><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary[<span class="st">'mean'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>trace_alpha_summary[<span class="st">'mean'</span>])) <span class="co"># convert logit to probability</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary[<span class="st">'hdi_3%'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>trace_alpha_summary[<span class="st">'hdi_3%'</span>])) <span class="co"># convert logit to probability</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>trace_alpha_summary[<span class="st">'hdi_97%'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>trace_alpha_summary[<span class="st">'hdi_97%'</span>])) <span class="co"># convert logit to probability</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>display(trace_alpha_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-industry-trace-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-center="true" data-tbl-col="true" data-execution_count="26">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-industry-trace-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Summary of Posterior Distributions
</figcaption>
<div aria-describedby="tbl-industry-trace-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sd</th>
<th data-quarto-table-cell-role="th">hdi_3%</th>
<th data-quarto-table-cell-role="th">hdi_97%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">alpha_industry[Leisure and hospitality]</td>
<td>0.056786</td>
<td>0.02</td>
<td>0.055201</td>
<td>0.058967</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">alpha_industry[Educational and health services]</td>
<td>0.023661</td>
<td>0.02</td>
<td>0.022977</td>
<td>0.024364</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">alpha_industry[Wholesale and retail trade]</td>
<td>0.042290</td>
<td>0.02</td>
<td>0.040699</td>
<td>0.043522</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">alpha_industry[Manufacturing]</td>
<td>0.030769</td>
<td>0.02</td>
<td>0.029598</td>
<td>0.032295</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">alpha_industry[Financial activities]</td>
<td>0.022977</td>
<td>0.03</td>
<td>0.021881</td>
<td>0.024602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">alpha_industry[Professional and business services]</td>
<td>0.038791</td>
<td>0.02</td>
<td>0.037688</td>
<td>0.039925</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">alpha_industry[Public administration]</td>
<td>0.017810</td>
<td>0.04</td>
<td>0.016464</td>
<td>0.019265</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">alpha_industry[Transportation and utilities]</td>
<td>0.036969</td>
<td>0.03</td>
<td>0.035230</td>
<td>0.038791</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">alpha_industry[Information]</td>
<td>0.047426</td>
<td>0.04</td>
<td>0.043522</td>
<td>0.051174</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div></div></div>
</div></div>
<div id="137caf0a" class="cell markdown">
<p>The provided trace summary (<a href="#tbl-industry-trace-summary" class="quarto-xref">Table&nbsp;5</a>) details the posterior estimates for the alpha_industry parameters, which represent the estimated industry-specific parameters for unemployment probability. For example, ‘Leisure and hospitality’ has a mean of 0.056, while ‘Public administration’ has a mean of 0.018. The sd, hdi_3% and hdi_97% are consistently quite narrow across all industries, (e.g., ‘Leisure and hospitality’ from 0.055 to 0.059, a range of 0.004). This indicates a strong concentration of posterior probability around the mean estimates.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior mean</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean <span class="op">=</span> ur_industry_trace.posterior.mean(dim<span class="op">=</span>(<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean_iter <span class="op">=</span> ur_industry_post_mean.sortby(<span class="st">"alpha_industry"</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean_iter[<span class="st">'alpha_prob'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>ur_industry_post_mean_iter[<span class="st">'alpha_industry'</span>]))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean.to_dataframe()</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi <span class="op">=</span> az.hdi(ur_industry_trace)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi_iter <span class="op">=</span> ur_industry_post_hdi.sortby(ur_industry_post_mean_iter.alpha_industry)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi_iter[<span class="st">'alpha_prob'</span>]<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>ur_industry_post_hdi_iter[<span class="st">'alpha_industry'</span>]))</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi_iter.to_dataframe()</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the posterior alpha_industry (mean of unemployment)</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean_iter.plot.scatter(x<span class="op">=</span><span class="st">'industry'</span>, y<span class="op">=</span><span class="st">"alpha_prob"</span>, ax<span class="op">=</span>ax, alpha<span class="op">=</span><span class="fl">0.8</span>, s<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>ax.vlines(</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    np.arange(industry_names.size),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    ur_industry_post_hdi_iter.alpha_prob.sel(hdi<span class="op">=</span><span class="st">"lower"</span>),</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    ur_industry_post_hdi_iter.alpha_prob.sel(hdi<span class="op">=</span><span class="st">"higher"</span>),</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"orange"</span>,</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">3</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'lightgray'</span>)     </span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">10</span>, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Industry'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Posterior means'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Estimated Industry-Specific Unemployment Rate (Adaptive Pooling)"</span>, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout() </span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [27]:</pre></div><div id="cell-fig-industry-pgm-scatter" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior mean</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean <span class="op">=</span> ur_industry_trace.posterior.mean(dim<span class="op">=</span>(<span class="st">"chain"</span>, <span class="st">"draw"</span>))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean_iter <span class="op">=</span> ur_industry_post_mean.sortby(<span class="st">"alpha_industry"</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean_iter[<span class="st">'alpha_prob'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>ur_industry_post_mean_iter[<span class="st">'alpha_industry'</span>]))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean.to_dataframe()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi <span class="op">=</span> az.hdi(ur_industry_trace)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi_iter <span class="op">=</span> ur_industry_post_hdi.sortby(ur_industry_post_mean_iter.alpha_industry)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi_iter[<span class="st">'alpha_prob'</span>]<span class="op">=</span><span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>ur_industry_post_hdi_iter[<span class="st">'alpha_industry'</span>]))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>ur_industry_post_hdi_iter.to_dataframe()</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the posterior alpha_industry (mean of unemployment)</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>ur_industry_post_mean_iter.plot.scatter(x<span class="op">=</span><span class="st">'industry'</span>, y<span class="op">=</span><span class="st">"alpha_prob"</span>, ax<span class="op">=</span>ax, alpha<span class="op">=</span><span class="fl">0.8</span>, s<span class="op">=</span><span class="dv">80</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>ax.vlines(</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    np.arange(industry_names.size),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    ur_industry_post_hdi_iter.alpha_prob.sel(hdi<span class="op">=</span><span class="st">"lower"</span>),</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    ur_industry_post_hdi_iter.alpha_prob.sel(hdi<span class="op">=</span><span class="st">"higher"</span>),</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"orange"</span>,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">3</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">'lightgray'</span>)     </span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelsize<span class="op">=</span><span class="dv">10</span>, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Industry'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Posterior means'</span>, fontsize <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Estimated Industry-Specific Unemployment Rate (Adaptive Pooling)"</span>, y<span class="op">=</span><span class="fl">1.02</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>plt.tight_layout() </span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-industry-pgm-scatter" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Plot the scatter plot of the estimated unemployment rates by industries">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-industry-pgm-scatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="index_files/figure-html/fig-industry-pgm-scatter-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Figure&nbsp;8: Estimated Industry-Specific Unemployment Rate (Adaptive Pooliing)"><img src="index_files/figure-html/fig-industry-pgm-scatter-output-1.png" alt="Plot the scatter plot of the estimated unemployment rates by industries" width="944" height="748" class="figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-industry-pgm-scatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Estimated Industry-Specific Unemployment Rate (Adaptive Pooliing)
</figcaption>
</figure>
</div>
</div>
</div></div>
<div id="0a9d08dd" class="cell markdown">
<p>The PGM estimated unemployment rates graphed in <a href="#fig-industry-pgm-scatter" class="quarto-xref">Figure&nbsp;8</a> reveals distinct causal influences of industry type on unemployment probability. The model infers that the ‘Leisure and Hospitality’ industry has the highest positive causal effect on unemployment likelihood. Conversely, ‘Public Administration’ and ‘Financial Services’ show a negative causal influence, resulting in lower estimated unemployment rates. The ‘Information’ industry, while having the second-highest mean unemployment, exhibits the widest credible interval, indicating greater uncertainty in quantifying its causal impact on employment stability.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the trace for Information, Leisure &amp; Hospitality, Government Administration and Financial services</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>trace_industries<span class="op">=</span> [<span class="st">'Leisure and hospitality'</span>,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Financial activities'</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Public administration'</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Information'</span>]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">## create subset of the trace summary with the selected industries alpha transformed to probabilities</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>alpha_industry_subset <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>ur_industry_trace.posterior[<span class="st">'alpha_industry'</span>].sel(industry<span class="op">=</span>trace_industries)))</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>trace_for_plot <span class="op">=</span> az.InferenceData(</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    posterior<span class="op">=</span>xr.Dataset(</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        data_vars<span class="op">=</span>{</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sigma'</span>: ur_industry_trace.posterior[<span class="st">'sigma'</span>],</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'alpha_industry'</span>: alpha_industry_subset</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>az.plot_trace(trace_for_plot)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-container"><div class="cell-decorator"><pre>In [28]:</pre></div><div id="737050e9" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the trace for Information, Leisure &amp; Hospitality, Government Administration and Financial services</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>trace_industries<span class="op">=</span> [<span class="st">'Leisure and hospitality'</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Financial activities'</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Public administration'</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Information'</span>]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">## create subset of the trace summary with the selected industries alpha transformed to probabilities</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>alpha_industry_subset <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>ur_industry_trace.posterior[<span class="st">'alpha_industry'</span>].sel(industry<span class="op">=</span>trace_industries)))</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>trace_for_plot <span class="op">=</span> az.InferenceData(</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    posterior<span class="op">=</span>xr.Dataset(</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>        data_vars<span class="op">=</span>{</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'sigma'</span>: ur_industry_trace.posterior[<span class="st">'sigma'</span>],</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'alpha_industry'</span>: alpha_industry_subset</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>az.plot_trace(trace_for_plot)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="index_files/figure-html/cell-29-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="index_files/figure-html/cell-29-output-1.png" width="1137" height="369" class="figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
</section>
<div id="f0473977" class="cell markdown">
<section id="references" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Joseph2024" class="csl-entry" role="listitem">
Joseph Dean, Estee Smith. 2024. <span>“<a href="">Gender Differences in Unemployment Trends: Race, Jobs and the Economy Update for February 2024</a>.”</span> <em>NCRC</em>, March.
</div>
<div id="ref-TOIEducation2025" class="csl-entry" role="listitem">
TOIEducation. 2025. <span>“<a href="">Degrees at Risk: 10 US College Majors with the Highest Unemployment Rate in 2025</a>.”</span> <em>The Times Of India</em>, July.
</div>
<div id="ref-Oberlo2024" class="csl-entry" role="listitem">
<span>“<a href="">US UNEMPLOYMENT RATE BY INDUSTRY (2024)</a>.”</span> 2024. <em>Oberlo</em>.
</div>
<div id="ref-ValerieWilson2022" class="csl-entry" role="listitem">
Wilson, Valerie, and William Darity-Jr. 2022. <span>“<a href="">Understanding Black-White Disparities in Labor Market Outcomes Requires Models That Account for Persistent Discrimination and Unequal Bargaining Power</a>.”</span> <em>Economic Policy Institute</em>, March.
</div>
<div id="ref-YiLiChienandPaulMorris" class="csl-entry" role="listitem">
YiLi Chien, Paul Morris. 2016. <span>“<a href="">Unemployment by Industry: Duration Must Be Considered, Too</a>.”</span> <em>Federal Reserve Bank of St.Lois - Regional Economist</em>, January.
</div>
</div>
</section>
</div>
     </main>
<!-- /main column -->  <script type="application/vnd.jupyter.widget-state+json">
{"state":{"27c00a1ffc4f480d9df5fe2ee4670992":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"989ce53bbf6846d5b648d2bbad5a6c5d":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e8941c71942e4ed0b4d04f1133625cf0":{"model_module":"@jupyter-widgets/output","model_module_version":"1.0.0","model_name":"OutputModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/output","_model_module_version":"1.0.0","_model_name":"OutputModel","_view_count":null,"_view_module":"@jupyter-widgets/output","_view_module_version":"1.0.0","_view_name":"OutputView","layout":"IPY_MODEL_27c00a1ffc4f480d9df5fe2ee4670992","msg_id":"","outputs":[{"data":{"text/html":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">                                                                                                                   \n <span style=\"font-weight: bold\"> Progress                  </span> <span style=\"font-weight: bold\"> Draws </span> <span style=\"font-weight: bold\"> Divergences </span> <span style=\"font-weight: bold\"> Step size </span> <span style=\"font-weight: bold\"> Grad evals </span> <span style=\"font-weight: bold\"> Sampling Speed </span> <span style=\"font-weight: bold\"> Elapsed </span> <span style=\"font-weight: bold\"> Remaining </span> \n ───────────────────────────────────────────────────────────────────────────────────────────────────────────────── \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   1000    0             0.93        7            7.92 draws/s     0:02:06   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   1000    0             0.77        7            7.70 draws/s     0:02:09   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   1000    0             0.98        3            7.97 draws/s     0:02:05   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   1000    0             0.56        7            8.01 draws/s     0:02:04   0:00:00    \n                                                                                                                   \n</pre>\n","text/plain":"                                                                                                                   \n \u001b[1m \u001b[0m\u001b[1mProgress                 \u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mDraws\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mDivergences\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mStep size\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mGrad evals\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mSampling Speed\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mElapsed\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mRemaining\u001b[0m\u001b[1m \u001b[0m \n ───────────────────────────────────────────────────────────────────────────────────────────────────────────────── \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   1000    0             0.93        7            7.92 draws/s     0:02:06   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   1000    0             0.77        7            7.70 draws/s     0:02:09   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   1000    0             0.98        3            7.97 draws/s     0:02:05   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   1000    0             0.56        7            8.01 draws/s     0:02:04   0:00:00    \n                                                                                                                   \n"},"metadata":{},"output_type":"display_data"}],"tabbable":null,"tooltip":null}},"f52eb5559a1548189c7c46c9cea1d134":{"model_module":"@jupyter-widgets/output","model_module_version":"1.0.0","model_name":"OutputModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/output","_model_module_version":"1.0.0","_model_name":"OutputModel","_view_count":null,"_view_module":"@jupyter-widgets/output","_view_module_version":"1.0.0","_view_name":"OutputView","layout":"IPY_MODEL_989ce53bbf6846d5b648d2bbad5a6c5d","msg_id":"","outputs":[{"data":{"text/html":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">                                                                                                                   \n <span style=\"font-weight: bold\"> Progress                  </span> <span style=\"font-weight: bold\"> Draws </span> <span style=\"font-weight: bold\"> Divergences </span> <span style=\"font-weight: bold\"> Step size </span> <span style=\"font-weight: bold\"> Grad evals </span> <span style=\"font-weight: bold\"> Sampling Speed </span> <span style=\"font-weight: bold\"> Elapsed </span> <span style=\"font-weight: bold\"> Remaining </span> \n ───────────────────────────────────────────────────────────────────────────────────────────────────────────────── \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             0.41        7            152.26 draws/s   0:00:13   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             0.62        7            153.39 draws/s   0:00:13   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             0.72        7            156.82 draws/s   0:00:12   0:00:00    \n  <span style=\"color: #1f77b4; text-decoration-color: #1f77b4\">━━━━━━━━━━━━━━━━━━━━━━━━━</span>   2000    0             0.44        7            149.73 draws/s   0:00:13   0:00:00    \n                                                                                                                   \n</pre>\n","text/plain":"                                                                                                                   \n \u001b[1m \u001b[0m\u001b[1mProgress                 \u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mDraws\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mDivergences\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mStep size\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mGrad evals\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mSampling Speed\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mElapsed\u001b[0m\u001b[1m \u001b[0m \u001b[1m \u001b[0m\u001b[1mRemaining\u001b[0m\u001b[1m \u001b[0m \n ───────────────────────────────────────────────────────────────────────────────────────────────────────────────── \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             0.41        7            152.26 draws/s   0:00:13   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             0.62        7            153.39 draws/s   0:00:13   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             0.72        7            156.82 draws/s   0:00:12   0:00:00    \n  \u001b[38;2;31;119;180m━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m   2000    0             0.44        7            149.73 draws/s   0:00:13   0:00:00    \n                                                                                                                   \n"},"metadata":{},"output_type":"display_data"}],"tabbable":null,"tooltip":null}}},"version_major":2,"version_minor":0}
</script>  <script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script> 
  
</body></html>